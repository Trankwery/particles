\hypertarget{render__particles_8cpp_source}{\section{render\-\_\-particles.\-cpp}
}

\begin{DoxyCode}
00001 \textcolor{comment}{/*}
00002 \textcolor{comment}{ * Copyright 1993-2012 NVIDIA Corporation.  All rights reserved.}
00003 \textcolor{comment}{ *}
00004 \textcolor{comment}{ * Please refer to the NVIDIA end user license agreement (EULA) associated}
00005 \textcolor{comment}{ * with this source code for terms and conditions that govern your use of}
00006 \textcolor{comment}{ * this software. Any use, reproduction, disclosure, or distribution of}
00007 \textcolor{comment}{ * this software and related documentation outside the terms of the EULA}
00008 \textcolor{comment}{ * is strictly prohibited.}
00009 \textcolor{comment}{ *}
00010 \textcolor{comment}{ */}
00011 
00012 \textcolor{preprocessor}{#}\textcolor{preprocessor}{include} \textcolor{preprocessor}{<}\textcolor{preprocessor}{GL}\textcolor{preprocessor}{/}\textcolor{preprocessor}{glew}\textcolor{preprocessor}{.}\textcolor{preprocessor}{h}\textcolor{preprocessor}{>}
00013 
00014 \textcolor{preprocessor}{#}\textcolor{preprocessor}{include} \textcolor{preprocessor}{<}\textcolor{preprocessor}{math}\textcolor{preprocessor}{.}\textcolor{preprocessor}{h}\textcolor{preprocessor}{>}
00015 \textcolor{preprocessor}{#}\textcolor{preprocessor}{include} \textcolor{preprocessor}{<}\textcolor{preprocessor}{assert}\textcolor{preprocessor}{.}\textcolor{preprocessor}{h}\textcolor{preprocessor}{>}
00016 \textcolor{preprocessor}{#}\textcolor{preprocessor}{include} \textcolor{preprocessor}{<}\textcolor{preprocessor}{stdio}\textcolor{preprocessor}{.}\textcolor{preprocessor}{h}\textcolor{preprocessor}{>}
00017 
00018 \textcolor{preprocessor}{#}\textcolor{preprocessor}{include} \hyperlink{render__particles_8h}{"render\_particles.h"}
00019 \textcolor{preprocessor}{#}\textcolor{preprocessor}{include} \hyperlink{shaders_8h}{"shaders.h"}
00020 
00021 \textcolor{preprocessor}{#}\textcolor{preprocessor}{ifndef} \textcolor{preprocessor}{M\_PI}
\hypertarget{render__particles_8cpp_source_l00022}{}\hyperlink{render__particles_8cpp_ae71449b1cc6e6250b91f539153a7a0d3}{00022} \textcolor{preprocessor}{#}\textcolor{preprocessor}{define} \textcolor{preprocessor}{M\_PI}    3.1415926535897932384626433832795
00023 \textcolor{preprocessor}{#}\textcolor{preprocessor}{endif}
00024 
\hypertarget{render__particles_8cpp_source_l00025}{}\hyperlink{class_particle_renderer_a1718484686c2e6db488cc88c433d03cc}{00025} \hyperlink{class_particle_renderer}{ParticleRenderer}::\hyperlink{class_particle_renderer_a1718484686c2e6db488cc88c433d03cc}{ParticleRenderer}()
00026     : \hyperlink{class_particle_renderer_a1d74720edb5c3a13edcdd176ac0d84c7}{m\_pos}(0),
00027       \hyperlink{class_particle_renderer_af885fdb5e6da925209dfd960f66b5fd8}{m\_numParticles}(0),
00028       \hyperlink{class_particle_renderer_a1ca13e546c937cb546c0da19fa853b34}{m\_pointSize}(1.0f),
00029       \hyperlink{class_particle_renderer_aab5ee3cd769a64c45dc9714aabdb0ee2}{m\_particleRadius}(0.125f * 0.5f),
00030       \hyperlink{class_particle_renderer_a1718484686c2e6db488cc88c433d03cc}{m\_program}(0),
00031       \hyperlink{class_particle_renderer_a1718484686c2e6db488cc88c433d03cc}{m\_vbo}(0),
00032       \hyperlink{class_particle_renderer_a1718484686c2e6db488cc88c433d03cc}{m\_colorVBO}(0)
00033 \{
00034     \hyperlink{class_particle_renderer_ac75c7f73a0014333305b174b8863a46b}{\_initGL}\hyperlink{class_particle_renderer_ac75c7f73a0014333305b174b8863a46b}{(}\hyperlink{class_particle_renderer_ac75c7f73a0014333305b174b8863a46b}{)};
00035 \}
00036 
\hypertarget{render__particles_8cpp_source_l00037}{}\hyperlink{class_particle_renderer_a281be31ad850fead012460fb6675db98}{00037} \hyperlink{class_particle_renderer}{ParticleRenderer}::~\hyperlink{class_particle_renderer_a281be31ad850fead012460fb6675db98}{ParticleRenderer}()
00038 \{
00039     \hyperlink{class_particle_renderer_a1d74720edb5c3a13edcdd176ac0d84c7}{m\_pos} = 0;
00040 \}
00041 
\hypertarget{render__particles_8cpp_source_l00042}{}\hyperlink{class_particle_renderer_adb3204e8af23a65b05b1aca7f43f0430}{00042} \textcolor{keywordtype}{void} \hyperlink{class_particle_renderer}{ParticleRenderer}::\hyperlink{class_particle_renderer_adb3204e8af23a65b05b1aca7f43f0430}{setPositions}(\textcolor{keywordtype}{float} *pos, \textcolor{keywordtype}{int} numParticles)
00043 \{
00044     \hyperlink{class_particle_renderer_a1d74720edb5c3a13edcdd176ac0d84c7}{m\_pos} = pos;
00045     \hyperlink{class_particle_renderer_af885fdb5e6da925209dfd960f66b5fd8}{m\_numParticles} = numParticles;
00046 \}
00047 
\hypertarget{render__particles_8cpp_source_l00048}{}\hyperlink{class_particle_renderer_a9c0d44ba7666ab432004a5df4cbb2b59}{00048} \textcolor{keywordtype}{void} \hyperlink{class_particle_renderer}{ParticleRenderer}::\hyperlink{class_particle_renderer_a9c0d44ba7666ab432004a5df4cbb2b59}{setVertexBuffer}(\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} vbo, \textcolor{keywordtype}{int} 
      numParticles)
00049 \{
00050     m\_vbo = vbo;
00051     \hyperlink{class_particle_renderer_af885fdb5e6da925209dfd960f66b5fd8}{m\_numParticles} = numParticles;
00052 \}
00053 
\hypertarget{render__particles_8cpp_source_l00054}{}\hyperlink{class_particle_renderer_a2683c43c010bff7973a977c1953f2bd6}{00054} \textcolor{keywordtype}{void} \hyperlink{class_particle_renderer}{ParticleRenderer}::\hyperlink{class_particle_renderer_a2683c43c010bff7973a977c1953f2bd6}{\_drawPoints}()
00055 \{
00056     \textcolor{keywordflow}{if} (!m\_vbo)
00057     \{
00058         glBegin(GL\_POINTS);
00059         \{
00060             \textcolor{keywordtype}{int} k = 0;
00061 
00062             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < m\_numParticles; ++i)
00063             \{
00064                 glVertex3fv(&m\_pos[k]);
00065                 k += 4;
00066             \}
00067         \}
00068         glEnd();
00069     \}
00070     \textcolor{keywordflow}{else}
00071     \{
00072         glBindBufferARB(GL\_ARRAY\_BUFFER\_ARB, m\_vbo);
00073         glVertexPointer(4, GL\_FLOAT, 0, 0);
00074         glEnableClientState(GL\_VERTEX\_ARRAY);
00075 
00076         \textcolor{keywordflow}{if} (m\_colorVBO)
00077         \{
00078             glBindBufferARB(GL\_ARRAY\_BUFFER\_ARB, m\_colorVBO);
00079             glColorPointer(4, GL\_FLOAT, 0, 0);
00080             glEnableClientState(GL\_COLOR\_ARRAY);
00081         \}
00082 
00083         glDrawArrays(GL\_POINTS, 0, m\_numParticles);
00084 
00085         glBindBufferARB(GL\_ARRAY\_BUFFER\_ARB, 0);
00086         glDisableClientState(GL\_VERTEX\_ARRAY);
00087         glDisableClientState(GL\_COLOR\_ARRAY);
00088     \}
00089 \}
00090 
\hypertarget{render__particles_8cpp_source_l00091}{}\hyperlink{class_particle_renderer_a80b2f52dc28bb3abbde021f7fe96f8ff}{00091} \textcolor{keywordtype}{void} \hyperlink{class_particle_renderer}{ParticleRenderer}::\hyperlink{class_particle_renderer_a80b2f52dc28bb3abbde021f7fe96f8ff}{display}(\hyperlink{class_particle_renderer_a7b691afffd1abe415cb0ce17fd26f3d5}{DisplayMode} mode \textcolor{comment}{/* =
       PARTICLE\_POINTS */})
00092 \{
00093     \textcolor{keywordflow}{switch} (mode)
00094     \{
00095         \textcolor{keywordflow}{case} PARTICLE\_POINTS:
00096             glColor3f(1, 1, 1);
00097             glPointSize(m\_pointSize);
00098             \hyperlink{class_particle_renderer_a2683c43c010bff7973a977c1953f2bd6}{\_drawPoints}\hyperlink{class_particle_renderer_a2683c43c010bff7973a977c1953f2bd6}{(}\hyperlink{class_particle_renderer_a2683c43c010bff7973a977c1953f2bd6}{)};
00099             \textcolor{keywordflow}{break};
00100 
00101         \textcolor{keywordflow}{default}:
00102         \textcolor{keywordflow}{case} PARTICLE\_SPHERES:
00103             glEnable(GL\_POINT\_SPRITE\_ARB);
00104             glTexEnvi(GL\_POINT\_SPRITE\_ARB, GL\_COORD\_REPLACE\_ARB, GL\_TRUE);
00105             glEnable(GL\_VERTEX\_PROGRAM\_POINT\_SIZE\_NV);
00106             glDepthMask(GL\_TRUE);
00107             glEnable(GL\_DEPTH\_TEST);
00108 
00109             glUseProgram(m\_program);
00110             glUniform1f(glGetUniformLocation(m\_program, \textcolor{stringliteral}{"pointScale"}), m\_window\_h / tanf(m\_fov*0.5f*(\textcolor{keywordtype}{
      float})\hyperlink{render__particles_8cpp_ae71449b1cc6e6250b91f539153a7a0d3}{M\_PI}/180.0f));
00111             glUniform1f(glGetUniformLocation(m\_program, \textcolor{stringliteral}{"pointRadius"}), m\_particleRadius);
00112 
00113             glColor3f(1, 1, 1);
00114             \hyperlink{class_particle_renderer_a2683c43c010bff7973a977c1953f2bd6}{\_drawPoints}\hyperlink{class_particle_renderer_a2683c43c010bff7973a977c1953f2bd6}{(}\hyperlink{class_particle_renderer_a2683c43c010bff7973a977c1953f2bd6}{)};
00115 
00116             glUseProgram(0);
00117             glDisable(GL\_POINT\_SPRITE\_ARB);
00118             \textcolor{keywordflow}{break};
00119     \}
00120 \}
00121 
00122 \hyperlink{class_particle_renderer_a3a7af352d38734b6bfa425e3b207d60b}{GLuint}
\hypertarget{render__particles_8cpp_source_l00123}{}\hyperlink{class_particle_renderer_a3a7af352d38734b6bfa425e3b207d60b}{00123} \hyperlink{class_particle_renderer}{ParticleRenderer}::\hyperlink{class_particle_renderer_a3a7af352d38734b6bfa425e3b207d60b}{\_compileProgram}(\textcolor{keyword}{const} \textcolor{keywordtype}{char} *
      \hyperlink{class_particle_renderer_a3a7af352d38734b6bfa425e3b207d60b}{vsource}, \textcolor{keyword}{const} \textcolor{keywordtype}{char} *\hyperlink{class_particle_renderer_a3a7af352d38734b6bfa425e3b207d60b}{fsource})
00124 \{
00125     GLuint vertexShader = glCreateShader(GL\_VERTEX\_SHADER);
00126     GLuint fragmentShader = glCreateShader(GL\_FRAGMENT\_SHADER);
00127 
00128     glShaderSource(vertexShader, 1, &vsource, 0);
00129     glShaderSource(fragmentShader, 1, &fsource, 0);
00130 
00131     glCompileShader(vertexShader);
00132     glCompileShader(fragmentShader);
00133 
00134     GLuint program = glCreateProgram();
00135 
00136     glAttachShader(program, vertexShader);
00137     glAttachShader(program, fragmentShader);
00138 
00139     glLinkProgram(program);
00140 
00141     \textcolor{comment}{// check if program linked}
00142     GLint success = 0;
00143     glGetProgramiv(program, GL\_LINK\_STATUS, &success);
00144 
00145     \textcolor{keywordflow}{if} (!success)
00146     \{
00147         \textcolor{keywordtype}{char} temp[256];
00148         glGetProgramInfoLog(program, 256, 0, temp);
00149         printf(\textcolor{stringliteral}{"Failed to link program:\(\backslash\)n%s\(\backslash\)n"}, temp);
00150         glDeleteProgram(program);
00151         program = 0;
00152     \}
00153 
00154     \textcolor{keywordflow}{return} program;
00155 \}
00156 
\hypertarget{render__particles_8cpp_source_l00157}{}\hyperlink{class_particle_renderer_ac75c7f73a0014333305b174b8863a46b}{00157} \textcolor{keywordtype}{void} \hyperlink{class_particle_renderer}{ParticleRenderer}::\hyperlink{class_particle_renderer_ac75c7f73a0014333305b174b8863a46b}{\_initGL}()
00158 \{
00159     m\_program = \_compileProgram(vertexShader, spherePixelShader);
00160 
00161 #\textcolor{keywordflow}{if} !defined(\_\_APPLE\_\_) && !defined(MACOSX)
00162     glClampColorARB(GL\_CLAMP\_VERTEX\_COLOR\_ARB, GL\_FALSE);
00163     glClampColorARB(GL\_CLAMP\_FRAGMENT\_COLOR\_ARB, GL\_FALSE);
00164 #endif
00165 \}
\end{DoxyCode}
