\hypertarget{structintegrate__functor}{\section{Dokumentacja struktury integrate\-\_\-functor}
\label{structintegrate__functor}\index{integrate\-\_\-functor@{integrate\-\_\-functor}}
}


ta struktura inicjowana jest z krokiem delta\-\_\-time dla danych opisujących prędkość i położenie cząstki, te dane siedzą w wektorze thrust (w G\-P\-U) jako para (tuple) float4 położenia i prędkości  




Diagram współpracy dla integrate\-\_\-functor\-:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=184pt]{structintegrate__functor__coll__graph}
\end{center}
\end{figure}
\subsection*{Metody publiczne}
\begin{DoxyCompactItemize}
\item 
\-\_\-\-\_\-host\-\_\-\-\_\- \-\_\-\-\_\-device\-\_\-\-\_\- \hyperlink{structintegrate__functor_a13075d4c547ba22c37137ff2b874ae45}{integrate\-\_\-functor} (float delta\-\_\-time)
\item 
{\footnotesize template$<$typename Tuple $>$ }\\\-\_\-\-\_\-device\-\_\-\-\_\- void \hyperlink{structintegrate__functor_a772e86ead8690332beb50911e4448f81}{operator()} (Tuple t)
\begin{DoxyCompactList}\small\item\em nowe położenie \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Atrybuty publiczne}
\begin{DoxyCompactItemize}
\item 
float \hyperlink{structintegrate__functor_a06dce1826719cd5b2a9fdd9f566da754}{delta\-Time}
\end{DoxyCompactItemize}


\subsection{Opis szczegółowy}
ta struktura inicjowana jest z krokiem delta\-\_\-time dla danych opisujących prędkość i położenie cząstki, te dane siedzą w wektorze thrust (w G\-P\-U) jako para (tuple) float4 położenia i prędkości 

Definicja w linii \hyperlink{particles__kernel__impl_8cuh_source_l00051}{51} pliku \hyperlink{particles__kernel__impl_8cuh_source}{particles\-\_\-kernel\-\_\-impl.\-cuh}.



\subsection{Dokumentacja konstruktora i destruktora}
\hypertarget{structintegrate__functor_a13075d4c547ba22c37137ff2b874ae45}{\index{integrate\-\_\-functor@{integrate\-\_\-functor}!integrate\-\_\-functor@{integrate\-\_\-functor}}
\index{integrate\-\_\-functor@{integrate\-\_\-functor}!integrate_functor@{integrate\-\_\-functor}}
\subsubsection[{integrate\-\_\-functor}]{\setlength{\rightskip}{0pt plus 5cm}\-\_\-\-\_\-host\-\_\-\-\_\- \-\_\-\-\_\-device\-\_\-\-\_\- integrate\-\_\-functor\-::integrate\-\_\-functor (
\begin{DoxyParamCaption}
\item[{float}]{delta\-\_\-time}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [inline]}}}\label{structintegrate__functor_a13075d4c547ba22c37137ff2b874ae45}


Definicja w linii \hyperlink{particles__kernel__impl_8cuh_source_l00056}{56} pliku \hyperlink{particles__kernel__impl_8cuh_source}{particles\-\_\-kernel\-\_\-impl.\-cuh}.



Odwołuje się do \hyperlink{particles__kernel__impl_8cuh_source_l00064}{operator()()}.


\begin{DoxyCode}
00056 : \hyperlink{structintegrate__functor_a06dce1826719cd5b2a9fdd9f566da754}{deltaTime}(delta\_time) \{\}
\end{DoxyCode}


Oto graf wywołań dla tej funkcji\-:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=306pt]{structintegrate__functor_a13075d4c547ba22c37137ff2b874ae45_cgraph}
\end{center}
\end{figure}




\subsection{Dokumentacja funkcji składowych}
\hypertarget{structintegrate__functor_a772e86ead8690332beb50911e4448f81}{\index{integrate\-\_\-functor@{integrate\-\_\-functor}!operator()@{operator()}}
\index{operator()@{operator()}!integrate_functor@{integrate\-\_\-functor}}
\subsubsection[{operator()}]{\setlength{\rightskip}{0pt plus 5cm}template$<$typename Tuple $>$ \-\_\-\-\_\-device\-\_\-\-\_\- void integrate\-\_\-functor\-::operator() (
\begin{DoxyParamCaption}
\item[{Tuple}]{t}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [inline]}}}\label{structintegrate__functor_a772e86ead8690332beb50911e4448f81}


nowe położenie 


\begin{DoxyParams}{Parametry}
{\em t} & para położenia i prędkości wylicza nowe położenie i sprawdza czy położenie nie jest za brzegiem \\
\hline
\end{DoxyParams}
$<$ grawitacja

$<$ ruchy Browna

$<$ lepkosc

$<$ przemieszczenie

$<$ odbijanie sie od kuli vel napiecie powierzchniowe

$<$ blat 

Definicja w linii \hyperlink{particles__kernel__impl_8cuh_source_l00064}{64} pliku \hyperlink{particles__kernel__impl_8cuh_source}{particles\-\_\-kernel\-\_\-impl.\-cuh}.



Odwołuje się do \hyperlink{particles__kernel__impl_8cuh_source_l00064}{operator()()}.



Odwołania w \hyperlink{particles__kernel__impl_8cuh_source_l00056}{integrate\-\_\-functor()} i \hyperlink{particles__kernel__impl_8cuh_source_l00064}{operator()()}.


\begin{DoxyCode}
00065     \{
00066         \textcolor{keyword}{volatile} float4 posData = thrust::get<0>(t);
00067         \textcolor{keyword}{volatile} float4 velData = thrust::get<1>(t);
00068         float3 pos = make\_float3(posData.x, posData.y, posData.z);
00069         float3 vel = make\_float3(velData.x, velData.y, velData.z);
00070 
00071         vel += \hyperlink{particles__kernel__impl_8cuh_a8db8938e28edd17862daf58651051bdc}{params}.\hyperlink{struct_sim_params_ae7508eba5dd90859215b59d19e001bb9}{gravity} * \hyperlink{structintegrate__functor_a06dce1826719cd5b2a9fdd9f566da754}{deltaTime};
00072                 \textcolor{keywordflow}{if}(\hyperlink{particles__kernel__impl_8cuh_a8db8938e28edd17862daf58651051bdc}{params}.\hyperlink{struct_sim_params_a88dae34e74c9184adfa9169bad06d0ee}{brown}!=0.0f)
00073         \{
00074                         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} seed=threadIdx.x+(((gridDim.x*blockIdx.y)+blockIdx.x)*blockDim.x)+(\textcolor{keywordtype}{
      unsigned} \textcolor{keywordtype}{int})floor((vel.x+vel.y+vel.z)*\hyperlink{particles__kernel__impl_8cuh_a8db8938e28edd17862daf58651051bdc}{params}.\hyperlink{struct_sim_params_a366145dd58e2e7eacebffcbe78dd89ff}{brownQuality});
00075                         curandState s;
00076                         curand\_init(seed,0,0,&s);
00077                         skipahead((\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} \textcolor{keywordtype}{long} \textcolor{keywordtype}{int})floor(vel.z*\hyperlink{particles__kernel__impl_8cuh_a8db8938e28edd17862daf58651051bdc}{params}.
      \hyperlink{struct_sim_params_a366145dd58e2e7eacebffcbe78dd89ff}{brownQuality}+pos.x+pos.y+pos.z),&s);
00078                         vel.x+=(curand\_normal(&s))*\hyperlink{particles__kernel__impl_8cuh_a8db8938e28edd17862daf58651051bdc}{params}.\hyperlink{struct_sim_params_a88dae34e74c9184adfa9169bad06d0ee}{brown};
00079                         skipahead((\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} \textcolor{keywordtype}{long} \textcolor{keywordtype}{int})floor(vel.y*\hyperlink{particles__kernel__impl_8cuh_a8db8938e28edd17862daf58651051bdc}{params}.
      \hyperlink{struct_sim_params_a366145dd58e2e7eacebffcbe78dd89ff}{brownQuality}),&s);
00080                         vel.y+=(curand\_normal(&s))*\hyperlink{particles__kernel__impl_8cuh_a8db8938e28edd17862daf58651051bdc}{params}.\hyperlink{struct_sim_params_a88dae34e74c9184adfa9169bad06d0ee}{brown};
00081                         skipahead((\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} \textcolor{keywordtype}{long} \textcolor{keywordtype}{int})floor(vel.x*\hyperlink{particles__kernel__impl_8cuh_a8db8938e28edd17862daf58651051bdc}{params}.
      \hyperlink{struct_sim_params_a366145dd58e2e7eacebffcbe78dd89ff}{brownQuality}),&s);
00082                         vel.z+=(curand\_normal(&s))*\hyperlink{particles__kernel__impl_8cuh_a8db8938e28edd17862daf58651051bdc}{params}.\hyperlink{struct_sim_params_a88dae34e74c9184adfa9169bad06d0ee}{brown};
00083                 \}
00084                 \textcolor{comment}{//vel.x-=(0.1f+vel.x+vel.y*2.0f+vel.z*4.5f+pos.y+pos.z)/(100.0f)*params.brown;}
00085                 \textcolor{comment}{//vel.y-=(0.1f+vel.x*3.5f+vel.y+vel.z*2.5f+pos.x+pos.z)/(100.0f)*params.brown;}
00086                 \textcolor{comment}{//vel.z-=(0.1f+vel.x*1.5f+vel.y*5.0f+vel.z+pos.x+pos.y)/(100.0f)*params.brown;}
00087 
00088         vel *= \hyperlink{particles__kernel__impl_8cuh_a8db8938e28edd17862daf58651051bdc}{params}.\hyperlink{struct_sim_params_a7058bad8c867d9d42d8c9d842638ebea}{globalDamping};
00089                 \textcolor{comment}{//vel += params.gravity * deltaTime;}
00090 
00091         \textcolor{comment}{// new position = old position + velocity * deltaTime}
00092 
00093         pos += vel * \hyperlink{structintegrate__functor_a06dce1826719cd5b2a9fdd9f566da754}{deltaTime};
00095         \textcolor{comment}{// set this to zero to disable collisions with cube sides}
00096 \textcolor{preprocessor}{#if 0}
00097 \textcolor{preprocessor}{}
00098         \textcolor{keywordflow}{if} (pos.x > 1.0f - \hyperlink{particles__kernel__impl_8cuh_a8db8938e28edd17862daf58651051bdc}{params}.\hyperlink{struct_sim_params_a7e131c24e1020c44173deb0f57a8c4af}{particleRadius})
00099         \{
00100             pos.x = 1.0f - \hyperlink{particles__kernel__impl_8cuh_a8db8938e28edd17862daf58651051bdc}{params}.\hyperlink{struct_sim_params_a7e131c24e1020c44173deb0f57a8c4af}{particleRadius};
00101             vel.x *= \hyperlink{particles__kernel__impl_8cuh_a8db8938e28edd17862daf58651051bdc}{params}.\hyperlink{struct_sim_params_a4da0c7593d6569e48ee50e7d0c7576f9}{boundaryDamping};
00102         \}
00103 
00104         \textcolor{keywordflow}{if} (pos.x < -1.0f + \hyperlink{particles__kernel__impl_8cuh_a8db8938e28edd17862daf58651051bdc}{params}.\hyperlink{struct_sim_params_a7e131c24e1020c44173deb0f57a8c4af}{particleRadius})
00105         \{
00106             pos.x = -1.0f + \hyperlink{particles__kernel__impl_8cuh_a8db8938e28edd17862daf58651051bdc}{params}.\hyperlink{struct_sim_params_a7e131c24e1020c44173deb0f57a8c4af}{particleRadius};
00107             vel.x *= \hyperlink{particles__kernel__impl_8cuh_a8db8938e28edd17862daf58651051bdc}{params}.\hyperlink{struct_sim_params_a4da0c7593d6569e48ee50e7d0c7576f9}{boundaryDamping};
00108         \}
00109 
00110         \textcolor{keywordflow}{if} (pos.y > 1.0f - \hyperlink{particles__kernel__impl_8cuh_a8db8938e28edd17862daf58651051bdc}{params}.\hyperlink{struct_sim_params_a7e131c24e1020c44173deb0f57a8c4af}{particleRadius})
00111         \{
00112             pos.y = 1.0f - \hyperlink{particles__kernel__impl_8cuh_a8db8938e28edd17862daf58651051bdc}{params}.\hyperlink{struct_sim_params_a7e131c24e1020c44173deb0f57a8c4af}{particleRadius};
00113             vel.y *= \hyperlink{particles__kernel__impl_8cuh_a8db8938e28edd17862daf58651051bdc}{params}.\hyperlink{struct_sim_params_a4da0c7593d6569e48ee50e7d0c7576f9}{boundaryDamping};
00114         \}
00115 
00116         \textcolor{keywordflow}{if} (pos.z > 1.0f - \hyperlink{particles__kernel__impl_8cuh_a8db8938e28edd17862daf58651051bdc}{params}.\hyperlink{struct_sim_params_a7e131c24e1020c44173deb0f57a8c4af}{particleRadius})
00117         \{
00118             pos.z = 1.0f - \hyperlink{particles__kernel__impl_8cuh_a8db8938e28edd17862daf58651051bdc}{params}.\hyperlink{struct_sim_params_a7e131c24e1020c44173deb0f57a8c4af}{particleRadius};
00119             vel.z *= \hyperlink{particles__kernel__impl_8cuh_a8db8938e28edd17862daf58651051bdc}{params}.\hyperlink{struct_sim_params_a4da0c7593d6569e48ee50e7d0c7576f9}{boundaryDamping};
00120         \}
00121 
00122         \textcolor{keywordflow}{if} (pos.z < -1.0f + \hyperlink{particles__kernel__impl_8cuh_a8db8938e28edd17862daf58651051bdc}{params}.\hyperlink{struct_sim_params_a7e131c24e1020c44173deb0f57a8c4af}{particleRadius})
00123         \{
00124             pos.z = -1.0f + \hyperlink{particles__kernel__impl_8cuh_a8db8938e28edd17862daf58651051bdc}{params}.\hyperlink{struct_sim_params_a7e131c24e1020c44173deb0f57a8c4af}{particleRadius};
00125             vel.z *= \hyperlink{particles__kernel__impl_8cuh_a8db8938e28edd17862daf58651051bdc}{params}.\hyperlink{struct_sim_params_a4da0c7593d6569e48ee50e7d0c7576f9}{boundaryDamping};
00126         \}
00127 
00128 \textcolor{preprocessor}{#endif}
00129 \textcolor{preprocessor}{}
00130                 \textcolor{comment}{//odbijanie sie od kuli}
00132 \textcolor{comment}{}\textcolor{preprocessor}{#if 1}
00133 \textcolor{preprocessor}{}                \textcolor{keywordtype}{float} xk=pos.x*pos.x;
00134                 \textcolor{keywordtype}{float} yk=pos.y*pos.y;
00135                 \textcolor{keywordtype}{float} zk=pos.z*pos.z;
00136                 \textcolor{keywordtype}{float} r0k=xk+yk+zk;
00137                 \textcolor{keywordtype}{float} R=\hyperlink{particles__kernel__impl_8cuh_a8db8938e28edd17862daf58651051bdc}{params}.\hyperlink{struct_sim_params_af41979948fdd8f76fe28ce2b43eb24cd}{bigradius};\textcolor{comment}{//- params.particleRadius;}
00138                 \textcolor{keywordtype}{float} r0=sqrt(r0k);
00139                 \textcolor{keywordflow}{if}(\hyperlink{particles__kernel__impl_8cuh_a8db8938e28edd17862daf58651051bdc}{params}.\hyperlink{struct_sim_params_a01507f06cc018071a0eb741438aaa09b}{boundaries} && r0>R-\hyperlink{particles__kernel__impl_8cuh_a8db8938e28edd17862daf58651051bdc}{params}.
      \hyperlink{struct_sim_params_a7e131c24e1020c44173deb0f57a8c4af}{particleRadius} && r0<R+\hyperlink{particles__kernel__impl_8cuh_a8db8938e28edd17862daf58651051bdc}{params}.\hyperlink{struct_sim_params_a7e131c24e1020c44173deb0f57a8c4af}{particleRadius})
00140                 \{
00141                         \textcolor{comment}{/*if(r0>r+params.particleRadius)}
00142 \textcolor{comment}{                        \{}
00143 \textcolor{comment}{                                float tmp=(r+params.particleRadius/2)/r0;}
00144 \textcolor{comment}{                                pos.x*=tmp;}
00145 \textcolor{comment}{                                pos.y*=tmp;}
00146 \textcolor{comment}{                                pos.z*=tmp;}
00147 \textcolor{comment}{                        \}*/}
00148                         float3 relPos = pos;
00149                         \textcolor{keywordtype}{float} dist = length(relPos);
00150                         float3 norm = relPos / dist;
00151                         vel+=-\hyperlink{particles__kernel__impl_8cuh_a8db8938e28edd17862daf58651051bdc}{params}.\hyperlink{struct_sim_params_a4da0c7593d6569e48ee50e7d0c7576f9}{boundaryDamping}*(abs(r0-R)-(
      \hyperlink{particles__kernel__impl_8cuh_a8db8938e28edd17862daf58651051bdc}{params}.\hyperlink{struct_sim_params_a7e131c24e1020c44173deb0f57a8c4af}{particleRadius}))*norm*deltaTime/\hyperlink{particles__kernel__impl_8cuh_a8db8938e28edd17862daf58651051bdc}{params}.
      \hyperlink{struct_sim_params_afab015432bd796517e5f540f6f7228e4}{particleMass};
00152                 \}
00153                 \textcolor{comment}{/*if(r0k > r*r + FLT\_EPSILON )}
00154 \textcolor{comment}{                \{}
00155 \textcolor{comment}{                        r-=params.particleRadius*4;}
00156 \textcolor{comment}{                        //vel.x*=params.boundaryDamping;}
00157 \textcolor{comment}{                        //vel.y*=params.boundaryDamping;}
00158 \textcolor{comment}{                        //vel.z*=params.boundaryDamping;}
00159 \textcolor{comment}{                        vel.x=0.0f;}
00160 \textcolor{comment}{                        vel.y=0.0f;}
00161 \textcolor{comment}{                        vel.z=0.0f;}
00162 \textcolor{comment}{                        //float theta=atan(pos.z/sqrt(pos.x*pos.x+pos.y*pos.y));}
00163 \textcolor{comment}{                        //float fi=atan(pos.y/pos.x);}
00164 \textcolor{comment}{                        //pos.z=r*sin(theta);}
00165 \textcolor{comment}{                        //float rr=r*cos(theta);}
00166 \textcolor{comment}{                        //pos.x=rr*cos(fi);}
00167 \textcolor{comment}{                        //pos.y=rr*sin(fi);}
00168 \textcolor{comment}{                        float r0=sqrt(r0k);}
00169 \textcolor{comment}{                        float tmp=r/r0;}
00170 \textcolor{comment}{                        pos.x*=tmp;}
00171 \textcolor{comment}{                        pos.y*=tmp;}
00172 \textcolor{comment}{                        pos.z*=tmp;}
00173 \textcolor{comment}{                \}*/}
00174 \textcolor{preprocessor}{#endif}
00175 \textcolor{preprocessor}{}
00176 \textcolor{comment}{//dolna plaszczyzna}
00177 
00178 \textcolor{preprocessor}{#if 1}
00179 \textcolor{preprocessor}{}                \textcolor{keywordflow}{if} (pos.y < -2.0f*\hyperlink{particles__kernel__impl_8cuh_a8db8938e28edd17862daf58651051bdc}{params}.\hyperlink{struct_sim_params_a5809a1ec819f5a99e350ed28b01834fc}{bigradius0} + \hyperlink{particles__kernel__impl_8cuh_a8db8938e28edd17862daf58651051bdc}{params}.
      \hyperlink{struct_sim_params_a7e131c24e1020c44173deb0f57a8c4af}{particleRadius})
00180         \{
00181             pos.y = -2.0f*\hyperlink{particles__kernel__impl_8cuh_a8db8938e28edd17862daf58651051bdc}{params}.\hyperlink{struct_sim_params_a5809a1ec819f5a99e350ed28b01834fc}{bigradius0} + \hyperlink{particles__kernel__impl_8cuh_a8db8938e28edd17862daf58651051bdc}{params}.
      \hyperlink{struct_sim_params_a7e131c24e1020c44173deb0f57a8c4af}{particleRadius};
00182             vel.y = 0;
00183         \}
00184 \textcolor{preprocessor}{#endif}
00185 \textcolor{preprocessor}{}
00186         \textcolor{comment}{// store new position and velocity}
00187         thrust::get<0>(t) = make\_float4(pos, posData.w);
00188         thrust::get<1>(t) = make\_float4(vel, velData.w);
00189     \}
\end{DoxyCode}


Oto graf wywołań dla tej funkcji\-:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=175pt]{structintegrate__functor_a772e86ead8690332beb50911e4448f81_cgraph}
\end{center}
\end{figure}




Oto graf wywoływań tej funkcji\-:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=306pt]{structintegrate__functor_a772e86ead8690332beb50911e4448f81_icgraph}
\end{center}
\end{figure}




\subsection{Dokumentacja atrybutów składowych}
\hypertarget{structintegrate__functor_a06dce1826719cd5b2a9fdd9f566da754}{\index{integrate\-\_\-functor@{integrate\-\_\-functor}!delta\-Time@{delta\-Time}}
\index{delta\-Time@{delta\-Time}!integrate_functor@{integrate\-\_\-functor}}
\subsubsection[{delta\-Time}]{\setlength{\rightskip}{0pt plus 5cm}float integrate\-\_\-functor\-::delta\-Time}}\label{structintegrate__functor_a06dce1826719cd5b2a9fdd9f566da754}


Definicja w linii \hyperlink{particles__kernel__impl_8cuh_source_l00053}{53} pliku \hyperlink{particles__kernel__impl_8cuh_source}{particles\-\_\-kernel\-\_\-impl.\-cuh}.



Dokumentacja dla tej struktury została wygenerowana z pliku\-:\begin{DoxyCompactItemize}
\item 
\hyperlink{particles__kernel__impl_8cuh}{particles\-\_\-kernel\-\_\-impl.\-cuh}\end{DoxyCompactItemize}
