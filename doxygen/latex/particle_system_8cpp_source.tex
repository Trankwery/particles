\hypertarget{particle_system_8cpp_source}{\section{particle\-System.\-cpp}
}

\begin{DoxyCode}
00001 \textcolor{comment}{/*}
00002 \textcolor{comment}{ * Copyright 1993-2012 NVIDIA Corporation.  All rights reserved.}
00003 \textcolor{comment}{ *}
00004 \textcolor{comment}{ * Please refer to the NVIDIA end user license agreement (EULA) associated}
00005 \textcolor{comment}{ * with this source code for terms and conditions that govern your use of}
00006 \textcolor{comment}{ * this software. Any use, reproduction, disclosure, or distribution of}
00007 \textcolor{comment}{ * this software and related documentation outside the terms of the EULA}
00008 \textcolor{comment}{ * is strictly prohibited.}
00009 \textcolor{comment}{ *}
00010 \textcolor{comment}{ */}
00011 
00012 \textcolor{preprocessor}{#}\textcolor{preprocessor}{include} \hyperlink{particle_system_8h}{"particleSystem.h"}
00013 \textcolor{preprocessor}{#}\textcolor{preprocessor}{include} \hyperlink{particle_system_8cuh}{"particleSystem.cuh"}
00014 \textcolor{preprocessor}{#}\textcolor{preprocessor}{include} \hyperlink{particles__kernel_8cuh}{"particles\_kernel.cuh"}
00015 
00016 \textcolor{preprocessor}{#}\textcolor{preprocessor}{include} \textcolor{preprocessor}{<}\textcolor{preprocessor}{cuda\_runtime}\textcolor{preprocessor}{.}\textcolor{preprocessor}{h}\textcolor{preprocessor}{>}
00017 
00018 \textcolor{preprocessor}{#}\textcolor{preprocessor}{include} \textcolor{preprocessor}{<}\textcolor{preprocessor}{helper\_functions}\textcolor{preprocessor}{.}\textcolor{preprocessor}{h}\textcolor{preprocessor}{>}
00019 \textcolor{preprocessor}{#}\textcolor{preprocessor}{include} \textcolor{preprocessor}{<}\textcolor{preprocessor}{helper\_cuda}\textcolor{preprocessor}{.}\textcolor{preprocessor}{h}\textcolor{preprocessor}{>}
00020 
00021 \textcolor{preprocessor}{#}\textcolor{preprocessor}{include} \textcolor{preprocessor}{<}\textcolor{preprocessor}{assert}\textcolor{preprocessor}{.}\textcolor{preprocessor}{h}\textcolor{preprocessor}{>}
00022 \textcolor{preprocessor}{#}\textcolor{preprocessor}{include} \textcolor{preprocessor}{<}\textcolor{preprocessor}{math}\textcolor{preprocessor}{.}\textcolor{preprocessor}{h}\textcolor{preprocessor}{>}
00023 \textcolor{preprocessor}{#}\textcolor{preprocessor}{include} \textcolor{preprocessor}{<}\textcolor{preprocessor}{memory}\textcolor{preprocessor}{.}\textcolor{preprocessor}{h}\textcolor{preprocessor}{>}
00024 \textcolor{preprocessor}{#}\textcolor{preprocessor}{include} \textcolor{preprocessor}{<}\textcolor{preprocessor}{cstdio}\textcolor{preprocessor}{>}
00025 \textcolor{preprocessor}{#}\textcolor{preprocessor}{include} \textcolor{preprocessor}{<}\textcolor{preprocessor}{cstdlib}\textcolor{preprocessor}{>}
00026 \textcolor{preprocessor}{#}\textcolor{preprocessor}{include} \textcolor{preprocessor}{<}\textcolor{preprocessor}{algorithm}\textcolor{preprocessor}{>}
00027 \textcolor{preprocessor}{#}\textcolor{preprocessor}{include} \textcolor{preprocessor}{<}\textcolor{preprocessor}{GL}\textcolor{preprocessor}{/}\textcolor{preprocessor}{glew}\textcolor{preprocessor}{.}\textcolor{preprocessor}{h}\textcolor{preprocessor}{>}
00028 
00029 \textcolor{preprocessor}{#}\textcolor{preprocessor}{ifndef} \textcolor{preprocessor}{CUDART\_PI\_F}
\hypertarget{particle_system_8cpp_source_l00030}{}\hyperlink{particle_system_8cpp_a0af3123952dff68caffd7e1357abe1b7}{00030} \textcolor{preprocessor}{#}\textcolor{preprocessor}{define} \textcolor{preprocessor}{CUDART\_PI\_F}         3.141592654f
00031 \textcolor{preprocessor}{#}\textcolor{preprocessor}{endif}
00032 
\hypertarget{particle_system_8cpp_source_l00033}{}\hyperlink{class_particle_system_a8a2be3e93616aa694801369c8b8d12cb}{00033} \hyperlink{class_particle_system}{ParticleSystem}::\hyperlink{class_particle_system_a8a2be3e93616aa694801369c8b8d12cb}{ParticleSystem}(\hyperlink{particles__kernel_8cuh_a91ad9478d81a7aaf2593e8d9c3d06a14}{uint} numParticles, uint3 gridSize,
       \textcolor{keywordtype}{bool} bUseOpenGL) :
00034     \hyperlink{class_particle_system_a21bbfba9d8701a70bc6fddbf4fc3f5bd}{m\_bInitialized}(\textcolor{keyword}{false}),
00035     \hyperlink{class_particle_system_a5d99413ffc0791e6aa9f02308caf7f1e}{m\_bUseOpenGL}(bUseOpenGL),
00036     \hyperlink{class_particle_system_a23d238efa80a647d4b6cde034f486a91}{m\_numParticles}(numParticles),
00037     \hyperlink{class_particle_system_ab9d75471d2eaaeb8fa98d2f3f47d9c25}{m\_hPos}(0),
00038     \hyperlink{class_particle_system_a20560c896ee8a8bbc827a8e5902da7e2}{m\_hVel}(0),
00039     \hyperlink{class_particle_system_afff6217d2726217dff77c81ef3c23bfa}{m\_dPos}(0),
00040     \hyperlink{class_particle_system_a5efd31a2fdba8d98b105f4e546964cb5}{m\_dVel}(0),
00041     \hyperlink{class_particle_system_a8a2be3e93616aa694801369c8b8d12cb}{m\_gridSize}(\hyperlink{class_particle_system_a8a2be3e93616aa694801369c8b8d12cb}{gridSize}),
00042     \hyperlink{class_particle_system_a8a2be3e93616aa694801369c8b8d12cb}{m\_timer}(NULL),
00043     \hyperlink{class_particle_system_a7b4b053433c052518b8ecce1b02000f5}{m\_solverIterations}(1)
00044 \{
00045     m\_numGridCells = m\_gridSize.x*m\_gridSize.y*m\_gridSize.z;
00046     float3 worldSize = make\_float3(2.0f, 2.0f, 2.0f);
00047 
00048     \hyperlink{class_particle_system_a2a0452a32993337176d88fa2fbe63020}{m\_gridSortBits} = 18;    \textcolor{comment}{// increase this for larger grids}
00049 
00050     \textcolor{comment}{// set simulation parameters}
00051     m\_params.gridSize = m\_gridSize;
00052     m\_params.numCells = m\_numGridCells;
00053     m\_params.numBodies = m\_numParticles;
00054 
00055     m\_params.particleRadius = 1.0f / 64.0f;\textcolor{comment}{//32.0f / 64.0f;}
00056     m\_params.colliderPos = make\_float3(-1.2f, -0.8f, 0.8f);
00057     m\_params.colliderRadius = 0.2f;
00058 
00059     m\_params.worldOrigin = make\_float3(-1.0f, -1.0f, -1.0f);
00060     \textcolor{comment}{//    m\_params.cellSize = make\_float3(worldSize.x / m\_gridSize.x, worldSize.y / m\_gridSize.y,
       worldSize.z / m\_gridSize.z);}
00061     \textcolor{keywordtype}{float} cellSize = m\_params.particleRadius * 2.0f;  \textcolor{comment}{// cell size equal to particle diameter}
00062     m\_params.cellSize = make\_float3(cellSize, cellSize, cellSize);
00063 
00064     m\_params.spring = 0.5f;
00065     m\_params.damping = 0.02f;
00066     m\_params.shear = 0.1f;
00067     m\_params.attraction = 0.1f;
00068     m\_params.boundaryDamping = -0.1f;
00069 
00070     m\_params.gravity = make\_float3(0.0f, -0.0003f, 0.0f);
00071     m\_params.globalDamping = 1.0f;
00072 
00073         m\_params.bigradius=2.0f;\textcolor{comment}{//docelowo zmieny rozmiar zewnetrznej kuli}
00074 
00075     \hyperlink{class_particle_system_a484988642e046424d32a13709204e8de}{\_initialize}\hyperlink{class_particle_system_a484988642e046424d32a13709204e8de}{(}numParticles\hyperlink{class_particle_system_a484988642e046424d32a13709204e8de}{)};
00076 \}
00077 
\hypertarget{particle_system_8cpp_source_l00078}{}\hyperlink{class_particle_system_a6bc725349a763b9d6817950cde16a93f}{00078} \hyperlink{class_particle_system}{ParticleSystem}::~\hyperlink{class_particle_system_a6bc725349a763b9d6817950cde16a93f}{ParticleSystem}()
00079 \{
00080     \hyperlink{class_particle_system_a5d6a52db7d1277c8fe734ecceb69e5c6}{\_finalize}\hyperlink{class_particle_system_a5d6a52db7d1277c8fe734ecceb69e5c6}{(}\hyperlink{class_particle_system_a5d6a52db7d1277c8fe734ecceb69e5c6}{)};
00081     \hyperlink{class_particle_system_a23d238efa80a647d4b6cde034f486a91}{m\_numParticles} = 0;
00082 \}
00083 
00084 \hyperlink{particles__kernel_8cuh_a91ad9478d81a7aaf2593e8d9c3d06a14}{uint}
\hypertarget{particle_system_8cpp_source_l00085}{}\hyperlink{class_particle_system_a399eb5cb9c422fd3370899e4d8a5d62e}{00085} \hyperlink{class_particle_system}{ParticleSystem}::\hyperlink{class_particle_system_a399eb5cb9c422fd3370899e4d8a5d62e}{createVBO}(\hyperlink{particles__kernel_8cuh_a91ad9478d81a7aaf2593e8d9c3d06a14}{uint} size)
00086 \{
00087     GLuint vbo;
00088     glGenBuffers(1, &vbo);
00089     glBindBuffer(GL\_ARRAY\_BUFFER, vbo);
00090     glBufferData(GL\_ARRAY\_BUFFER, size, 0, GL\_DYNAMIC\_DRAW);
00091     glBindBuffer(GL\_ARRAY\_BUFFER, 0);
00092     \textcolor{keywordflow}{return} vbo;
00093 \}
00094 
\hypertarget{particle_system_8cpp_source_l00095}{}\hyperlink{particle_system_8cpp_aaece5bea3dfe5043f19232f3e6e1e575}{00095} \textcolor{keyword}{inline} \textcolor{keywordtype}{float} \hyperlink{particle_system_8cpp_aaece5bea3dfe5043f19232f3e6e1e575}{lerp}(\textcolor{keywordtype}{float} a, \textcolor{keywordtype}{float} b, \textcolor{keywordtype}{float} t)
00096 \{
00097     \textcolor{keywordflow}{return} a + t*(b-a);
00098 \}
00099 
00100 \textcolor{comment}{// create a color ramp}
\hypertarget{particle_system_8cpp_source_l00101}{}\hyperlink{particle_system_8cpp_a1ec1ae39a0b30ca8330f7839a624f302}{00101} \textcolor{keywordtype}{void} \hyperlink{particle_system_8cpp_a1ec1ae39a0b30ca8330f7839a624f302}{colorRamp}(\textcolor{keywordtype}{float} t, \textcolor{keywordtype}{float} *r)
00102 \{
00103     \textcolor{keyword}{const} \textcolor{keywordtype}{int} ncolors = 7;
00104     \textcolor{keywordtype}{float} c[ncolors][3] =
00105     \{
00106         \{ 1.0, 0.0, 0.0, \},
00107         \{ 1.0, 0.5, 0.0, \},
00108         \{ 1.0, 1.0, 0.0, \},
00109         \{ 0.0, 1.0, 0.0, \},
00110         \{ 0.0, 1.0, 1.0, \},
00111         \{ 0.0, 0.0, 1.0, \},
00112         \{ 1.0, 0.0, 1.0, \},
00113     \};
00114     t = t * (ncolors-1);
00115     \textcolor{keywordtype}{int} i = (\textcolor{keywordtype}{int}) t;
00116     \textcolor{keywordtype}{float} u = t - floor(t);
00117     r[0] = \hyperlink{particle_system_8cpp_aaece5bea3dfe5043f19232f3e6e1e575}{lerp}\hyperlink{particle_system_8cpp_aaece5bea3dfe5043f19232f3e6e1e575}{(}c[i][0]\hyperlink{particle_system_8cpp_aaece5bea3dfe5043f19232f3e6e1e575}{,} c[i+1][0]\hyperlink{particle_system_8cpp_aaece5bea3dfe5043f19232f3e6e1e575}{,} u\hyperlink{particle_system_8cpp_aaece5bea3dfe5043f19232f3e6e1e575}{)};
00118     r[1] = \hyperlink{particle_system_8cpp_aaece5bea3dfe5043f19232f3e6e1e575}{lerp}\hyperlink{particle_system_8cpp_aaece5bea3dfe5043f19232f3e6e1e575}{(}c[i][1]\hyperlink{particle_system_8cpp_aaece5bea3dfe5043f19232f3e6e1e575}{,} c[i+1][1]\hyperlink{particle_system_8cpp_aaece5bea3dfe5043f19232f3e6e1e575}{,} u\hyperlink{particle_system_8cpp_aaece5bea3dfe5043f19232f3e6e1e575}{)};
00119     r[2] = \hyperlink{particle_system_8cpp_aaece5bea3dfe5043f19232f3e6e1e575}{lerp}\hyperlink{particle_system_8cpp_aaece5bea3dfe5043f19232f3e6e1e575}{(}c[i][2]\hyperlink{particle_system_8cpp_aaece5bea3dfe5043f19232f3e6e1e575}{,} c[i+1][2]\hyperlink{particle_system_8cpp_aaece5bea3dfe5043f19232f3e6e1e575}{,} u\hyperlink{particle_system_8cpp_aaece5bea3dfe5043f19232f3e6e1e575}{)};
00120 \}
00121 
00122 \textcolor{keywordtype}{void}
\hypertarget{particle_system_8cpp_source_l00123}{}\hyperlink{class_particle_system_a484988642e046424d32a13709204e8de}{00123} \hyperlink{class_particle_system}{ParticleSystem}::\hyperlink{class_particle_system_a484988642e046424d32a13709204e8de}{\_initialize}(\textcolor{keywordtype}{int} numParticles)
00124 \{
00125     assert(!\hyperlink{class_particle_system_a21bbfba9d8701a70bc6fddbf4fc3f5bd}{m\_bInitialized});
00126 
00127     \hyperlink{class_particle_system_a23d238efa80a647d4b6cde034f486a91}{m\_numParticles} = numParticles;
00128 
00129     \textcolor{comment}{// allocate host storage}
00130     \hyperlink{class_particle_system_ab9d75471d2eaaeb8fa98d2f3f47d9c25}{m\_hPos} = \textcolor{keyword}{new} \textcolor{keywordtype}{float}[\hyperlink{class_particle_system_a23d238efa80a647d4b6cde034f486a91}{m\_numParticles}*4];
00131     \hyperlink{class_particle_system_a20560c896ee8a8bbc827a8e5902da7e2}{m\_hVel} = \textcolor{keyword}{new} \textcolor{keywordtype}{float}[\hyperlink{class_particle_system_a23d238efa80a647d4b6cde034f486a91}{m\_numParticles}*4];
00132 
00133     memset(\hyperlink{class_particle_system_ab9d75471d2eaaeb8fa98d2f3f47d9c25}{m\_hPos}, 0, \hyperlink{class_particle_system_a23d238efa80a647d4b6cde034f486a91}{m\_numParticles}*4*\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{float}));
00134     memset(\hyperlink{class_particle_system_a20560c896ee8a8bbc827a8e5902da7e2}{m\_hVel}, 0, \hyperlink{class_particle_system_a23d238efa80a647d4b6cde034f486a91}{m\_numParticles}*4*\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{float}));
00135 
00136     \hyperlink{class_particle_system_a8412ecd991c14d906fcebba42bdeffd3}{m\_hCellStart} = \textcolor{keyword}{new} \hyperlink{particles__kernel_8cuh_a91ad9478d81a7aaf2593e8d9c3d06a14}{uint}[\hyperlink{class_particle_system_aa1ef17d723af5d7a4685e8fd57e9ca89}{m\_numGridCells}];
00137     memset(\hyperlink{class_particle_system_a8412ecd991c14d906fcebba42bdeffd3}{m\_hCellStart}, 0, \hyperlink{class_particle_system_aa1ef17d723af5d7a4685e8fd57e9ca89}{m\_numGridCells}*\textcolor{keyword}{sizeof}(
      \hyperlink{particles__kernel_8cuh_a91ad9478d81a7aaf2593e8d9c3d06a14}{uint}));
00138 
00139     \hyperlink{class_particle_system_a8d8ad2d142f3a5b83f2c10a46f5d7a8b}{m\_hCellEnd} = \textcolor{keyword}{new} \hyperlink{particles__kernel_8cuh_a91ad9478d81a7aaf2593e8d9c3d06a14}{uint}[\hyperlink{class_particle_system_aa1ef17d723af5d7a4685e8fd57e9ca89}{m\_numGridCells}];
00140     memset(\hyperlink{class_particle_system_a8d8ad2d142f3a5b83f2c10a46f5d7a8b}{m\_hCellEnd}, 0, \hyperlink{class_particle_system_aa1ef17d723af5d7a4685e8fd57e9ca89}{m\_numGridCells}*\textcolor{keyword}{sizeof}(
      \hyperlink{particles__kernel_8cuh_a91ad9478d81a7aaf2593e8d9c3d06a14}{uint}));
00141 
00142     \textcolor{comment}{// allocate GPU data}
00143     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} memSize = \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{float}) * 4 * \hyperlink{class_particle_system_a23d238efa80a647d4b6cde034f486a91}{m\_numParticles};
00144 
00145     \textcolor{keywordflow}{if} (\hyperlink{class_particle_system_a5d99413ffc0791e6aa9f02308caf7f1e}{m\_bUseOpenGL})
00146     \{
00147         \hyperlink{class_particle_system_a31f9cccdf5dbae6f72867665bd8761e3}{m\_posVbo} = \hyperlink{class_particle_system_a399eb5cb9c422fd3370899e4d8a5d62e}{createVBO}\hyperlink{class_particle_system_a399eb5cb9c422fd3370899e4d8a5d62e}{(}memSize\hyperlink{class_particle_system_a399eb5cb9c422fd3370899e4d8a5d62e}{)};
00148         \hyperlink{particle_system_8cuh_a4386a84282ceeaba09939817aa2a9c24}{registerGLBufferObject}\hyperlink{particle_system_8cuh_a4386a84282ceeaba09939817aa2a9c24}{(}\hyperlink{class_particle_system_a31f9cccdf5dbae6f72867665bd8761e3}{m\_posVbo}\hyperlink{particle_system_8cuh_a4386a84282ceeaba09939817aa2a9c24}{,} &
      \hyperlink{class_particle_system_a9c5de70c1705672e5722ad30dee1b14b}{m\_cuda\_posvbo\_resource}\hyperlink{particle_system_8cuh_a4386a84282ceeaba09939817aa2a9c24}{)};
00149     \}
00150     \textcolor{keywordflow}{else}
00151     \{
00152         checkCudaErrors(cudaMalloc((\textcolor{keywordtype}{void} **)&m\_cudaPosVBO, memSize)) ;
00153     \}
00154 
00155     \hyperlink{particle_system_8cuh_aee51e01a5233e0fda578bd5b3bc38e8f}{allocateArray}\hyperlink{particle_system_8cuh_aee51e01a5233e0fda578bd5b3bc38e8f}{(}(\textcolor{keywordtype}{void} **)&\hyperlink{class_particle_system_a5efd31a2fdba8d98b105f4e546964cb5}{m\_dVel}\hyperlink{particle_system_8cuh_aee51e01a5233e0fda578bd5b3bc38e8f}{,} memSize\hyperlink{particle_system_8cuh_aee51e01a5233e0fda578bd5b3bc38e8f}{)};
00156 
00157     \hyperlink{particle_system_8cuh_aee51e01a5233e0fda578bd5b3bc38e8f}{allocateArray}\hyperlink{particle_system_8cuh_aee51e01a5233e0fda578bd5b3bc38e8f}{(}(\textcolor{keywordtype}{void} **)&\hyperlink{class_particle_system_ab60e8b5a312b2f400b10dfba5153fc3c}{m\_dSortedPos}\hyperlink{particle_system_8cuh_aee51e01a5233e0fda578bd5b3bc38e8f}{,} memSize
      \hyperlink{particle_system_8cuh_aee51e01a5233e0fda578bd5b3bc38e8f}{)};
00158     \hyperlink{particle_system_8cuh_aee51e01a5233e0fda578bd5b3bc38e8f}{allocateArray}\hyperlink{particle_system_8cuh_aee51e01a5233e0fda578bd5b3bc38e8f}{(}(\textcolor{keywordtype}{void} **)&\hyperlink{class_particle_system_a69122523117954fb5defb8b38e0f46f3}{m\_dSortedVel}\hyperlink{particle_system_8cuh_aee51e01a5233e0fda578bd5b3bc38e8f}{,} memSize
      \hyperlink{particle_system_8cuh_aee51e01a5233e0fda578bd5b3bc38e8f}{)};
00159 
00160     \hyperlink{particle_system_8cuh_aee51e01a5233e0fda578bd5b3bc38e8f}{allocateArray}\hyperlink{particle_system_8cuh_aee51e01a5233e0fda578bd5b3bc38e8f}{(}(\textcolor{keywordtype}{void} **)&\hyperlink{class_particle_system_ab44080655971a5501eaee6ad7355a139}{m\_dGridParticleHash}
      \hyperlink{particle_system_8cuh_aee51e01a5233e0fda578bd5b3bc38e8f}{,} \hyperlink{class_particle_system_a23d238efa80a647d4b6cde034f486a91}{m\_numParticles}*\textcolor{keyword}{sizeof}(\hyperlink{particles__kernel_8cuh_a91ad9478d81a7aaf2593e8d9c3d06a14}{uint})\hyperlink{particle_system_8cuh_aee51e01a5233e0fda578bd5b3bc38e8f}{)};
00161     \hyperlink{particle_system_8cuh_aee51e01a5233e0fda578bd5b3bc38e8f}{allocateArray}\hyperlink{particle_system_8cuh_aee51e01a5233e0fda578bd5b3bc38e8f}{(}(\textcolor{keywordtype}{void} **)&\hyperlink{class_particle_system_a1a67fc1e3ffd4e64f55a2a315c49c74c}{m\_dGridParticleIndex}
      \hyperlink{particle_system_8cuh_aee51e01a5233e0fda578bd5b3bc38e8f}{,} \hyperlink{class_particle_system_a23d238efa80a647d4b6cde034f486a91}{m\_numParticles}*\textcolor{keyword}{sizeof}(\hyperlink{particles__kernel_8cuh_a91ad9478d81a7aaf2593e8d9c3d06a14}{uint})\hyperlink{particle_system_8cuh_aee51e01a5233e0fda578bd5b3bc38e8f}{)};
00162 
00163     \hyperlink{particle_system_8cuh_aee51e01a5233e0fda578bd5b3bc38e8f}{allocateArray}\hyperlink{particle_system_8cuh_aee51e01a5233e0fda578bd5b3bc38e8f}{(}(\textcolor{keywordtype}{void} **)&\hyperlink{class_particle_system_a137909a8b34f7a42e50cd0fcc86bb784}{m\_dCellStart}\hyperlink{particle_system_8cuh_aee51e01a5233e0fda578bd5b3bc38e8f}{,} 
      \hyperlink{class_particle_system_aa1ef17d723af5d7a4685e8fd57e9ca89}{m\_numGridCells}*\textcolor{keyword}{sizeof}(\hyperlink{particles__kernel_8cuh_a91ad9478d81a7aaf2593e8d9c3d06a14}{uint})\hyperlink{particle_system_8cuh_aee51e01a5233e0fda578bd5b3bc38e8f}{)};
00164     \hyperlink{particle_system_8cuh_aee51e01a5233e0fda578bd5b3bc38e8f}{allocateArray}\hyperlink{particle_system_8cuh_aee51e01a5233e0fda578bd5b3bc38e8f}{(}(\textcolor{keywordtype}{void} **)&\hyperlink{class_particle_system_a3a0b9c760c2bfcf811d54b8194ebea01}{m\_dCellEnd}\hyperlink{particle_system_8cuh_aee51e01a5233e0fda578bd5b3bc38e8f}{,} 
      \hyperlink{class_particle_system_aa1ef17d723af5d7a4685e8fd57e9ca89}{m\_numGridCells}*\textcolor{keyword}{sizeof}(\hyperlink{particles__kernel_8cuh_a91ad9478d81a7aaf2593e8d9c3d06a14}{uint})\hyperlink{particle_system_8cuh_aee51e01a5233e0fda578bd5b3bc38e8f}{)};
00165 
00166     \textcolor{keywordflow}{if} (\hyperlink{class_particle_system_a5d99413ffc0791e6aa9f02308caf7f1e}{m\_bUseOpenGL})
00167     \{
00168         \hyperlink{class_particle_system_a96b05c719006c9e3eaed759f54a49c7f}{m\_colorVBO} = \hyperlink{class_particle_system_a399eb5cb9c422fd3370899e4d8a5d62e}{createVBO}\hyperlink{class_particle_system_a399eb5cb9c422fd3370899e4d8a5d62e}{(}\hyperlink{class_particle_system_a23d238efa80a647d4b6cde034f486a91}{m\_numParticles}*4*\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{float})
      \hyperlink{class_particle_system_a399eb5cb9c422fd3370899e4d8a5d62e}{)};
00169         \hyperlink{particle_system_8cuh_a4386a84282ceeaba09939817aa2a9c24}{registerGLBufferObject}\hyperlink{particle_system_8cuh_a4386a84282ceeaba09939817aa2a9c24}{(}\hyperlink{class_particle_system_a96b05c719006c9e3eaed759f54a49c7f}{m\_colorVBO}\hyperlink{particle_system_8cuh_a4386a84282ceeaba09939817aa2a9c24}{,} &
      \hyperlink{class_particle_system_a140043869727535abc08609b835b98fc}{m\_cuda\_colorvbo\_resource}\hyperlink{particle_system_8cuh_a4386a84282ceeaba09939817aa2a9c24}{)};
00170 
00171         \textcolor{comment}{// fill color buffer}
00172         glBindBufferARB(GL\_ARRAY\_BUFFER, m\_colorVBO);
00173         \textcolor{keywordtype}{float} *data = (\textcolor{keywordtype}{float} *) glMapBufferARB(GL\_ARRAY\_BUFFER, GL\_WRITE\_ONLY);
00174         \textcolor{keywordtype}{float} *ptr = data;
00175 
00176         \textcolor{keywordflow}{for} (\hyperlink{particles__kernel_8cuh_a91ad9478d81a7aaf2593e8d9c3d06a14}{uint} i=0; i<\hyperlink{class_particle_system_a23d238efa80a647d4b6cde034f486a91}{m\_numParticles}; i++)
00177         \{
00178             \textcolor{keywordtype}{float} t = i / (\textcolor{keywordtype}{float}) \hyperlink{class_particle_system_a23d238efa80a647d4b6cde034f486a91}{m\_numParticles};
00179 #\textcolor{keywordflow}{if} 0
00180             *ptr++ = rand() / (\textcolor{keywordtype}{float}) RAND\_MAX;
00181             *ptr++ = rand() / (\textcolor{keywordtype}{float}) RAND\_MAX;
00182             *ptr++ = rand() / (\textcolor{keywordtype}{float}) RAND\_MAX;
00183 #\textcolor{keywordflow}{else}
00184             \hyperlink{particle_system_8cpp_a1ec1ae39a0b30ca8330f7839a624f302}{colorRamp}\hyperlink{particle_system_8cpp_a1ec1ae39a0b30ca8330f7839a624f302}{(}t\hyperlink{particle_system_8cpp_a1ec1ae39a0b30ca8330f7839a624f302}{,} ptr\hyperlink{particle_system_8cpp_a1ec1ae39a0b30ca8330f7839a624f302}{)};
00185             ptr+=3;
00186 #endif
00187             *ptr++ = 1.0f;
00188         \}
00189 
00190         glUnmapBufferARB(GL\_ARRAY\_BUFFER);
00191     \}
00192     \textcolor{keywordflow}{else}
00193     \{
00194         checkCudaErrors(cudaMalloc((\textcolor{keywordtype}{void} **)&m\_cudaColorVBO, \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{float})*numParticles*4));
00195     \}
00196 
00197     sdkCreateTimer(&m\_timer);
00198 
00199     setParameters(&m\_params);
00200 
00201     \hyperlink{class_particle_system_a21bbfba9d8701a70bc6fddbf4fc3f5bd}{m\_bInitialized} = \textcolor{keyword}{true};
00202 \}
00203 
00204 \textcolor{keywordtype}{void}
\hypertarget{particle_system_8cpp_source_l00205}{}\hyperlink{class_particle_system_a5d6a52db7d1277c8fe734ecceb69e5c6}{00205} \hyperlink{class_particle_system}{ParticleSystem}::\hyperlink{class_particle_system_a5d6a52db7d1277c8fe734ecceb69e5c6}{\_finalize}()
00206 \{
00207     assert(\hyperlink{class_particle_system_a21bbfba9d8701a70bc6fddbf4fc3f5bd}{m\_bInitialized});
00208 
00209     \textcolor{keyword}{delete} [] \hyperlink{class_particle_system_ab9d75471d2eaaeb8fa98d2f3f47d9c25}{m\_hPos};
00210     \textcolor{keyword}{delete} [] \hyperlink{class_particle_system_a20560c896ee8a8bbc827a8e5902da7e2}{m\_hVel};
00211     \textcolor{keyword}{delete} [] \hyperlink{class_particle_system_a8412ecd991c14d906fcebba42bdeffd3}{m\_hCellStart};
00212     \textcolor{keyword}{delete} [] \hyperlink{class_particle_system_a8d8ad2d142f3a5b83f2c10a46f5d7a8b}{m\_hCellEnd};
00213 
00214     \hyperlink{particle_system_8cuh_a2946519c8d9c4f8ebf552bf044821ea9}{freeArray}\hyperlink{particle_system_8cuh_a2946519c8d9c4f8ebf552bf044821ea9}{(}\hyperlink{class_particle_system_a5efd31a2fdba8d98b105f4e546964cb5}{m\_dVel}\hyperlink{particle_system_8cuh_a2946519c8d9c4f8ebf552bf044821ea9}{)};
00215     \hyperlink{particle_system_8cuh_a2946519c8d9c4f8ebf552bf044821ea9}{freeArray}\hyperlink{particle_system_8cuh_a2946519c8d9c4f8ebf552bf044821ea9}{(}\hyperlink{class_particle_system_ab60e8b5a312b2f400b10dfba5153fc3c}{m\_dSortedPos}\hyperlink{particle_system_8cuh_a2946519c8d9c4f8ebf552bf044821ea9}{)};
00216     \hyperlink{particle_system_8cuh_a2946519c8d9c4f8ebf552bf044821ea9}{freeArray}\hyperlink{particle_system_8cuh_a2946519c8d9c4f8ebf552bf044821ea9}{(}\hyperlink{class_particle_system_a69122523117954fb5defb8b38e0f46f3}{m\_dSortedVel}\hyperlink{particle_system_8cuh_a2946519c8d9c4f8ebf552bf044821ea9}{)};
00217 
00218     \hyperlink{particle_system_8cuh_a2946519c8d9c4f8ebf552bf044821ea9}{freeArray}\hyperlink{particle_system_8cuh_a2946519c8d9c4f8ebf552bf044821ea9}{(}\hyperlink{class_particle_system_ab44080655971a5501eaee6ad7355a139}{m\_dGridParticleHash}\hyperlink{particle_system_8cuh_a2946519c8d9c4f8ebf552bf044821ea9}{)};
00219     \hyperlink{particle_system_8cuh_a2946519c8d9c4f8ebf552bf044821ea9}{freeArray}\hyperlink{particle_system_8cuh_a2946519c8d9c4f8ebf552bf044821ea9}{(}\hyperlink{class_particle_system_a1a67fc1e3ffd4e64f55a2a315c49c74c}{m\_dGridParticleIndex}\hyperlink{particle_system_8cuh_a2946519c8d9c4f8ebf552bf044821ea9}{)};
00220     \hyperlink{particle_system_8cuh_a2946519c8d9c4f8ebf552bf044821ea9}{freeArray}\hyperlink{particle_system_8cuh_a2946519c8d9c4f8ebf552bf044821ea9}{(}\hyperlink{class_particle_system_a137909a8b34f7a42e50cd0fcc86bb784}{m\_dCellStart}\hyperlink{particle_system_8cuh_a2946519c8d9c4f8ebf552bf044821ea9}{)};
00221     \hyperlink{particle_system_8cuh_a2946519c8d9c4f8ebf552bf044821ea9}{freeArray}\hyperlink{particle_system_8cuh_a2946519c8d9c4f8ebf552bf044821ea9}{(}\hyperlink{class_particle_system_a3a0b9c760c2bfcf811d54b8194ebea01}{m\_dCellEnd}\hyperlink{particle_system_8cuh_a2946519c8d9c4f8ebf552bf044821ea9}{)};
00222 
00223     \textcolor{keywordflow}{if} (\hyperlink{class_particle_system_a5d99413ffc0791e6aa9f02308caf7f1e}{m\_bUseOpenGL})
00224     \{
00225         \hyperlink{particle_system_8cuh_a9afef8c00ca779aae2d7484b45bce34c}{unregisterGLBufferObject}\hyperlink{particle_system_8cuh_a9afef8c00ca779aae2d7484b45bce34c}{(}
      \hyperlink{class_particle_system_a9c5de70c1705672e5722ad30dee1b14b}{m\_cuda\_posvbo\_resource}\hyperlink{particle_system_8cuh_a9afef8c00ca779aae2d7484b45bce34c}{)};
00226         glDeleteBuffers(1, (\textcolor{keyword}{const} GLuint *)&m\_posVbo);
00227         glDeleteBuffers(1, (\textcolor{keyword}{const} GLuint *)&m\_colorVBO);
00228     \}
00229     \textcolor{keywordflow}{else}
00230     \{
00231         checkCudaErrors(cudaFree(m\_cudaPosVBO));
00232         checkCudaErrors(cudaFree(m\_cudaColorVBO));
00233     \}
00234 \}
00235 
00236 \textcolor{comment}{// step the simulation}
00237 \textcolor{keywordtype}{void}
\hypertarget{particle_system_8cpp_source_l00238}{}\hyperlink{class_particle_system_a166fd86f020b6024d7d42723762d7cb2}{00238} \hyperlink{class_particle_system}{ParticleSystem}::\hyperlink{class_particle_system_a166fd86f020b6024d7d42723762d7cb2}{update}(\textcolor{keywordtype}{float} deltaTime)
00239 \{
00240     assert(\hyperlink{class_particle_system_a21bbfba9d8701a70bc6fddbf4fc3f5bd}{m\_bInitialized});
00241 
00242     \textcolor{keywordtype}{float} *dPos;
00243 
00244     \textcolor{keywordflow}{if} (\hyperlink{class_particle_system_a5d99413ffc0791e6aa9f02308caf7f1e}{m\_bUseOpenGL})
00245     \{
00246         dPos = (\textcolor{keywordtype}{float} *) \hyperlink{particle_system_8cuh_aa491077afd740a269815eb9ce81c8642}{mapGLBufferObject}\hyperlink{particle_system_8cuh_aa491077afd740a269815eb9ce81c8642}{(}&
      \hyperlink{class_particle_system_a9c5de70c1705672e5722ad30dee1b14b}{m\_cuda\_posvbo\_resource}\hyperlink{particle_system_8cuh_aa491077afd740a269815eb9ce81c8642}{)};
00247     \}
00248     \textcolor{keywordflow}{else}
00249     \{
00250         dPos = (\textcolor{keywordtype}{float} *) \hyperlink{class_particle_system_aba18245745f621d90186862f1a559d9e}{m\_cudaPosVBO};
00251     \}
00252 
00253     \textcolor{comment}{// update constants}
00254     setParameters(&m\_params);
00255 
00256     \textcolor{comment}{// integrate}
00257     \hyperlink{particle_system_8cuh_a34e9db8b801cd537e5ae5a4a886e020c}{integrateSystem}\hyperlink{particle_system_8cuh_a34e9db8b801cd537e5ae5a4a886e020c}{(}
00258         dPos\hyperlink{particle_system_8cuh_a34e9db8b801cd537e5ae5a4a886e020c}{,}
00259         \hyperlink{class_particle_system_a5efd31a2fdba8d98b105f4e546964cb5}{m\_dVel}\hyperlink{particle_system_8cuh_a34e9db8b801cd537e5ae5a4a886e020c}{,}
00260         deltaTime\hyperlink{particle_system_8cuh_a34e9db8b801cd537e5ae5a4a886e020c}{,}
00261         \hyperlink{class_particle_system_a23d238efa80a647d4b6cde034f486a91}{m\_numParticles}\hyperlink{particle_system_8cuh_a34e9db8b801cd537e5ae5a4a886e020c}{)};
00262 
00263     \textcolor{comment}{// calculate grid hash}
00264     \hyperlink{particle_system_8cuh_ae0a4037d25e768622443077546399cf2}{calcHash}\hyperlink{particle_system_8cuh_ae0a4037d25e768622443077546399cf2}{(}
00265         \hyperlink{class_particle_system_ab44080655971a5501eaee6ad7355a139}{m\_dGridParticleHash}\hyperlink{particle_system_8cuh_ae0a4037d25e768622443077546399cf2}{,}
00266         \hyperlink{class_particle_system_a1a67fc1e3ffd4e64f55a2a315c49c74c}{m\_dGridParticleIndex}\hyperlink{particle_system_8cuh_ae0a4037d25e768622443077546399cf2}{,}
00267         dPos\hyperlink{particle_system_8cuh_ae0a4037d25e768622443077546399cf2}{,}
00268         \hyperlink{class_particle_system_a23d238efa80a647d4b6cde034f486a91}{m\_numParticles}\hyperlink{particle_system_8cuh_ae0a4037d25e768622443077546399cf2}{)};
00269 
00270     \textcolor{comment}{// sort particles based on hash}
00271     \hyperlink{particle_system_8cuh_ac71da7e4672a2732a098ba933a799257}{sortParticles}\hyperlink{particle_system_8cuh_ac71da7e4672a2732a098ba933a799257}{(}\hyperlink{class_particle_system_ab44080655971a5501eaee6ad7355a139}{m\_dGridParticleHash}\hyperlink{particle_system_8cuh_ac71da7e4672a2732a098ba933a799257}{,} 
      \hyperlink{class_particle_system_a1a67fc1e3ffd4e64f55a2a315c49c74c}{m\_dGridParticleIndex}\hyperlink{particle_system_8cuh_ac71da7e4672a2732a098ba933a799257}{,} \hyperlink{class_particle_system_a23d238efa80a647d4b6cde034f486a91}{m\_numParticles}\hyperlink{particle_system_8cuh_ac71da7e4672a2732a098ba933a799257}{)};
00272 
00273     \textcolor{comment}{// reorder particle arrays into sorted order and}
00274     \textcolor{comment}{// find start and end of each cell}
00275     \hyperlink{particle_system_8cuh_ac72ccd068434c46c2f901c751d53be1d}{reorderDataAndFindCellStart}\hyperlink{particle_system_8cuh_ac72ccd068434c46c2f901c751d53be1d}{(}
00276         \hyperlink{class_particle_system_a137909a8b34f7a42e50cd0fcc86bb784}{m\_dCellStart}\hyperlink{particle_system_8cuh_ac72ccd068434c46c2f901c751d53be1d}{,}
00277         \hyperlink{class_particle_system_a3a0b9c760c2bfcf811d54b8194ebea01}{m\_dCellEnd}\hyperlink{particle_system_8cuh_ac72ccd068434c46c2f901c751d53be1d}{,}
00278         \hyperlink{class_particle_system_ab60e8b5a312b2f400b10dfba5153fc3c}{m\_dSortedPos}\hyperlink{particle_system_8cuh_ac72ccd068434c46c2f901c751d53be1d}{,}
00279         \hyperlink{class_particle_system_a69122523117954fb5defb8b38e0f46f3}{m\_dSortedVel}\hyperlink{particle_system_8cuh_ac72ccd068434c46c2f901c751d53be1d}{,}
00280         \hyperlink{class_particle_system_ab44080655971a5501eaee6ad7355a139}{m\_dGridParticleHash}\hyperlink{particle_system_8cuh_ac72ccd068434c46c2f901c751d53be1d}{,}
00281         \hyperlink{class_particle_system_a1a67fc1e3ffd4e64f55a2a315c49c74c}{m\_dGridParticleIndex}\hyperlink{particle_system_8cuh_ac72ccd068434c46c2f901c751d53be1d}{,}
00282         dPos\hyperlink{particle_system_8cuh_ac72ccd068434c46c2f901c751d53be1d}{,}
00283         \hyperlink{class_particle_system_a5efd31a2fdba8d98b105f4e546964cb5}{m\_dVel}\hyperlink{particle_system_8cuh_ac72ccd068434c46c2f901c751d53be1d}{,}
00284         \hyperlink{class_particle_system_a23d238efa80a647d4b6cde034f486a91}{m\_numParticles}\hyperlink{particle_system_8cuh_ac72ccd068434c46c2f901c751d53be1d}{,}
00285         \hyperlink{class_particle_system_aa1ef17d723af5d7a4685e8fd57e9ca89}{m\_numGridCells}\hyperlink{particle_system_8cuh_ac72ccd068434c46c2f901c751d53be1d}{)};
00286 
00287     \textcolor{comment}{// process collisions}
00288     \hyperlink{particle_system_8cuh_a917d67e2ed45ea11da51ac5d7004ddfd}{collide}\hyperlink{particle_system_8cuh_a917d67e2ed45ea11da51ac5d7004ddfd}{(}
00289         \hyperlink{class_particle_system_a5efd31a2fdba8d98b105f4e546964cb5}{m\_dVel}\hyperlink{particle_system_8cuh_a917d67e2ed45ea11da51ac5d7004ddfd}{,}
00290         \hyperlink{class_particle_system_ab60e8b5a312b2f400b10dfba5153fc3c}{m\_dSortedPos}\hyperlink{particle_system_8cuh_a917d67e2ed45ea11da51ac5d7004ddfd}{,}
00291         \hyperlink{class_particle_system_a69122523117954fb5defb8b38e0f46f3}{m\_dSortedVel}\hyperlink{particle_system_8cuh_a917d67e2ed45ea11da51ac5d7004ddfd}{,}
00292         \hyperlink{class_particle_system_a1a67fc1e3ffd4e64f55a2a315c49c74c}{m\_dGridParticleIndex}\hyperlink{particle_system_8cuh_a917d67e2ed45ea11da51ac5d7004ddfd}{,}
00293         \hyperlink{class_particle_system_a137909a8b34f7a42e50cd0fcc86bb784}{m\_dCellStart}\hyperlink{particle_system_8cuh_a917d67e2ed45ea11da51ac5d7004ddfd}{,}
00294         \hyperlink{class_particle_system_a3a0b9c760c2bfcf811d54b8194ebea01}{m\_dCellEnd}\hyperlink{particle_system_8cuh_a917d67e2ed45ea11da51ac5d7004ddfd}{,}
00295         \hyperlink{class_particle_system_a23d238efa80a647d4b6cde034f486a91}{m\_numParticles}\hyperlink{particle_system_8cuh_a917d67e2ed45ea11da51ac5d7004ddfd}{,}
00296         \hyperlink{class_particle_system_aa1ef17d723af5d7a4685e8fd57e9ca89}{m\_numGridCells}\hyperlink{particle_system_8cuh_a917d67e2ed45ea11da51ac5d7004ddfd}{)};
00297 
00298     \textcolor{comment}{// note: do unmap at end here to avoid unnecessary graphics/CUDA context switch}
00299     \textcolor{keywordflow}{if} (\hyperlink{class_particle_system_a5d99413ffc0791e6aa9f02308caf7f1e}{m\_bUseOpenGL})
00300     \{
00301         \hyperlink{particle_system_8cuh_a98c3325419b7528d34a51ca7972d7095}{unmapGLBufferObject}\hyperlink{particle_system_8cuh_a98c3325419b7528d34a51ca7972d7095}{(}\hyperlink{class_particle_system_a9c5de70c1705672e5722ad30dee1b14b}{m\_cuda\_posvbo\_resource}
      \hyperlink{particle_system_8cuh_a98c3325419b7528d34a51ca7972d7095}{)};
00302     \}
00303 \}
00304 
00305 \textcolor{keywordtype}{void}
\hypertarget{particle_system_8cpp_source_l00306}{}\hyperlink{class_particle_system_a722bdb7cc940f052400a69fe9569a49e}{00306} \hyperlink{class_particle_system}{ParticleSystem}::\hyperlink{class_particle_system_a722bdb7cc940f052400a69fe9569a49e}{dumpGrid}()
00307 \{
00308     \textcolor{comment}{// dump grid information}
00309     \hyperlink{particle_system_8cuh_a54716407dbd516db34f42b2faf7f91a3}{copyArrayFromDevice}\hyperlink{particle_system_8cuh_a54716407dbd516db34f42b2faf7f91a3}{(}\hyperlink{class_particle_system_a8412ecd991c14d906fcebba42bdeffd3}{m\_hCellStart}\hyperlink{particle_system_8cuh_a54716407dbd516db34f42b2faf7f91a3}{,} 
      \hyperlink{class_particle_system_a137909a8b34f7a42e50cd0fcc86bb784}{m\_dCellStart}\hyperlink{particle_system_8cuh_a54716407dbd516db34f42b2faf7f91a3}{,} 0\hyperlink{particle_system_8cuh_a54716407dbd516db34f42b2faf7f91a3}{,} \textcolor{keyword}{sizeof}(\hyperlink{particles__kernel_8cuh_a91ad9478d81a7aaf2593e8d9c3d06a14}{uint})*\hyperlink{class_particle_system_aa1ef17d723af5d7a4685e8fd57e9ca89}{m\_numGridCells}\hyperlink{particle_system_8cuh_a54716407dbd516db34f42b2faf7f91a3}{)};
00310     \hyperlink{particle_system_8cuh_a54716407dbd516db34f42b2faf7f91a3}{copyArrayFromDevice}\hyperlink{particle_system_8cuh_a54716407dbd516db34f42b2faf7f91a3}{(}\hyperlink{class_particle_system_a8d8ad2d142f3a5b83f2c10a46f5d7a8b}{m\_hCellEnd}\hyperlink{particle_system_8cuh_a54716407dbd516db34f42b2faf7f91a3}{,} 
      \hyperlink{class_particle_system_a3a0b9c760c2bfcf811d54b8194ebea01}{m\_dCellEnd}\hyperlink{particle_system_8cuh_a54716407dbd516db34f42b2faf7f91a3}{,} 0\hyperlink{particle_system_8cuh_a54716407dbd516db34f42b2faf7f91a3}{,} \textcolor{keyword}{sizeof}(\hyperlink{particles__kernel_8cuh_a91ad9478d81a7aaf2593e8d9c3d06a14}{uint})*\hyperlink{class_particle_system_aa1ef17d723af5d7a4685e8fd57e9ca89}{m\_numGridCells}\hyperlink{particle_system_8cuh_a54716407dbd516db34f42b2faf7f91a3}{)};
00311     \hyperlink{particles__kernel_8cuh_a91ad9478d81a7aaf2593e8d9c3d06a14}{uint} maxCellSize = 0;
00312 
00313     \textcolor{keywordflow}{for} (\hyperlink{particles__kernel_8cuh_a91ad9478d81a7aaf2593e8d9c3d06a14}{uint} i=0; i<\hyperlink{class_particle_system_aa1ef17d723af5d7a4685e8fd57e9ca89}{m\_numGridCells}; i++)
00314     \{
00315         \textcolor{keywordflow}{if} (\hyperlink{class_particle_system_a8412ecd991c14d906fcebba42bdeffd3}{m\_hCellStart}[i] != 0xffffffff)
00316         \{
00317             \hyperlink{particles__kernel_8cuh_a91ad9478d81a7aaf2593e8d9c3d06a14}{uint} cellSize = \hyperlink{class_particle_system_a8d8ad2d142f3a5b83f2c10a46f5d7a8b}{m\_hCellEnd}[i] - \hyperlink{class_particle_system_a8412ecd991c14d906fcebba42bdeffd3}{m\_hCellStart}[i];
00318 
00319             \textcolor{comment}{//            printf("cell: %d, %d particles\(\backslash\)n", i, cellSize);}
00320             \textcolor{keywordflow}{if} (cellSize > maxCellSize)
00321             \{
00322                 maxCellSize = cellSize;
00323             \}
00324         \}
00325     \}
00326 
00327     printf(\textcolor{stringliteral}{"maximum particles per cell = %d\(\backslash\)n"}, maxCellSize);
00328 \}
00329 
00330 \textcolor{keywordtype}{void}
\hypertarget{particle_system_8cpp_source_l00331}{}\hyperlink{class_particle_system_a9025f319e07c58c6ece1cd2a620ce33a}{00331} \hyperlink{class_particle_system}{ParticleSystem}::\hyperlink{class_particle_system_a9025f319e07c58c6ece1cd2a620ce33a}{dumpParticles}(\hyperlink{particles__kernel_8cuh_a91ad9478d81a7aaf2593e8d9c3d06a14}{uint} start, 
      \hyperlink{particles__kernel_8cuh_a91ad9478d81a7aaf2593e8d9c3d06a14}{uint} count)
00332 \{
00333     \textcolor{comment}{// debug}
00334     \hyperlink{particle_system_8cuh_a54716407dbd516db34f42b2faf7f91a3}{copyArrayFromDevice}\hyperlink{particle_system_8cuh_a54716407dbd516db34f42b2faf7f91a3}{(}\hyperlink{class_particle_system_ab9d75471d2eaaeb8fa98d2f3f47d9c25}{m\_hPos}\hyperlink{particle_system_8cuh_a54716407dbd516db34f42b2faf7f91a3}{,} 0\hyperlink{particle_system_8cuh_a54716407dbd516db34f42b2faf7f91a3}{,} &
      \hyperlink{class_particle_system_a9c5de70c1705672e5722ad30dee1b14b}{m\_cuda\_posvbo\_resource}\hyperlink{particle_system_8cuh_a54716407dbd516db34f42b2faf7f91a3}{,} \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{float})*4*count\hyperlink{particle_system_8cuh_a54716407dbd516db34f42b2faf7f91a3}{)};
00335     \hyperlink{particle_system_8cuh_a54716407dbd516db34f42b2faf7f91a3}{copyArrayFromDevice}\hyperlink{particle_system_8cuh_a54716407dbd516db34f42b2faf7f91a3}{(}\hyperlink{class_particle_system_a20560c896ee8a8bbc827a8e5902da7e2}{m\_hVel}\hyperlink{particle_system_8cuh_a54716407dbd516db34f42b2faf7f91a3}{,} \hyperlink{class_particle_system_a5efd31a2fdba8d98b105f4e546964cb5}{m\_dVel}\hyperlink{particle_system_8cuh_a54716407dbd516db34f42b2faf7f91a3}{,} 0
      \hyperlink{particle_system_8cuh_a54716407dbd516db34f42b2faf7f91a3}{,} \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{float})*4*count\hyperlink{particle_system_8cuh_a54716407dbd516db34f42b2faf7f91a3}{)};
00336 
00337     \textcolor{keywordflow}{for} (\hyperlink{particles__kernel_8cuh_a91ad9478d81a7aaf2593e8d9c3d06a14}{uint} i=start; i<start+count; i++)
00338     \{
00339         \textcolor{comment}{//        printf("%d: ", i);}
00340         printf(\textcolor{stringliteral}{"pos: (%.4f, %.4f, %.4f, %.4f)\(\backslash\)n"}, \hyperlink{class_particle_system_ab9d75471d2eaaeb8fa98d2f3f47d9c25}{m\_hPos}[i*4+0], 
      \hyperlink{class_particle_system_ab9d75471d2eaaeb8fa98d2f3f47d9c25}{m\_hPos}[i*4+1], \hyperlink{class_particle_system_ab9d75471d2eaaeb8fa98d2f3f47d9c25}{m\_hPos}[i*4+2], \hyperlink{class_particle_system_ab9d75471d2eaaeb8fa98d2f3f47d9c25}{m\_hPos}[i*4+3]);
00341         printf(\textcolor{stringliteral}{"vel: (%.4f, %.4f, %.4f, %.4f)\(\backslash\)n"}, \hyperlink{class_particle_system_a20560c896ee8a8bbc827a8e5902da7e2}{m\_hVel}[i*4+0], 
      \hyperlink{class_particle_system_a20560c896ee8a8bbc827a8e5902da7e2}{m\_hVel}[i*4+1], \hyperlink{class_particle_system_a20560c896ee8a8bbc827a8e5902da7e2}{m\_hVel}[i*4+2], \hyperlink{class_particle_system_a20560c896ee8a8bbc827a8e5902da7e2}{m\_hVel}[i*4+3]);
00342     \}
00343 \}
00344 
00345 \textcolor{keywordtype}{float} *
\hypertarget{particle_system_8cpp_source_l00346}{}\hyperlink{class_particle_system_a8bdfaa6198651ef0ceb8be489ecd78e3}{00346} \hyperlink{class_particle_system}{ParticleSystem}::\hyperlink{class_particle_system_a8bdfaa6198651ef0ceb8be489ecd78e3}{getArray}(\hyperlink{class_particle_system_a332fbe57a36aaea5c18b4ea4fba6bbb3}{ParticleArray} array)
00347 \{
00348     assert(\hyperlink{class_particle_system_a21bbfba9d8701a70bc6fddbf4fc3f5bd}{m\_bInitialized});
00349 
00350     \textcolor{keywordtype}{float} *hdata = 0;
00351     \textcolor{keywordtype}{float} *ddata = 0;
00352     \textcolor{keyword}{struct} cudaGraphicsResource *cuda\_vbo\_resource = 0;
00353 
00354     \textcolor{keywordflow}{switch} (array)
00355     \{
00356         \textcolor{keywordflow}{default}:
00357         \textcolor{keywordflow}{case} \hyperlink{class_particle_system_a332fbe57a36aaea5c18b4ea4fba6bbb3a9e9a2992d230a2674debf26e0e8e0299}{POSITION}:
00358             hdata = \hyperlink{class_particle_system_ab9d75471d2eaaeb8fa98d2f3f47d9c25}{m\_hPos};
00359             ddata = \hyperlink{class_particle_system_afff6217d2726217dff77c81ef3c23bfa}{m\_dPos};
00360             cuda\_vbo\_resource = \hyperlink{class_particle_system_a9c5de70c1705672e5722ad30dee1b14b}{m\_cuda\_posvbo\_resource};
00361             \textcolor{keywordflow}{break};
00362 
00363         \textcolor{keywordflow}{case} \hyperlink{class_particle_system_a332fbe57a36aaea5c18b4ea4fba6bbb3a3702de73065f01b4f6ffa604b799e53d}{VELOCITY}:
00364             hdata = \hyperlink{class_particle_system_a20560c896ee8a8bbc827a8e5902da7e2}{m\_hVel};
00365             ddata = \hyperlink{class_particle_system_a5efd31a2fdba8d98b105f4e546964cb5}{m\_dVel};
00366             \textcolor{keywordflow}{break};
00367     \}
00368 
00369     \hyperlink{particle_system_8cuh_a54716407dbd516db34f42b2faf7f91a3}{copyArrayFromDevice}\hyperlink{particle_system_8cuh_a54716407dbd516db34f42b2faf7f91a3}{(}hdata\hyperlink{particle_system_8cuh_a54716407dbd516db34f42b2faf7f91a3}{,} ddata\hyperlink{particle_system_8cuh_a54716407dbd516db34f42b2faf7f91a3}{,} &cuda\_vbo\_resource
      \hyperlink{particle_system_8cuh_a54716407dbd516db34f42b2faf7f91a3}{,} \hyperlink{class_particle_system_a23d238efa80a647d4b6cde034f486a91}{m\_numParticles}*4*\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{float})\hyperlink{particle_system_8cuh_a54716407dbd516db34f42b2faf7f91a3}{)};
00370     \textcolor{keywordflow}{return} hdata;
00371 \}
00372 
00373 \textcolor{keywordtype}{void}
\hypertarget{particle_system_8cpp_source_l00374}{}\hyperlink{class_particle_system_aa792a66680e800832059854aab0d594d}{00374} \hyperlink{class_particle_system}{ParticleSystem}::\hyperlink{class_particle_system_aa792a66680e800832059854aab0d594d}{setArray}(\hyperlink{class_particle_system_a332fbe57a36aaea5c18b4ea4fba6bbb3}{ParticleArray} array, \textcolor{keyword}{const} \textcolor{keywordtype}{float} *
      data, \textcolor{keywordtype}{int} start, \textcolor{keywordtype}{int} count)
00375 \{
00376     assert(\hyperlink{class_particle_system_a21bbfba9d8701a70bc6fddbf4fc3f5bd}{m\_bInitialized});
00377 
00378     \textcolor{keywordflow}{switch} (array)
00379     \{
00380         \textcolor{keywordflow}{default}:
00381         \textcolor{keywordflow}{case} \hyperlink{class_particle_system_a332fbe57a36aaea5c18b4ea4fba6bbb3a9e9a2992d230a2674debf26e0e8e0299}{POSITION}:
00382             \{
00383                 \textcolor{keywordflow}{if} (\hyperlink{class_particle_system_a5d99413ffc0791e6aa9f02308caf7f1e}{m\_bUseOpenGL})
00384                 \{
00385                     \hyperlink{particle_system_8cuh_a9afef8c00ca779aae2d7484b45bce34c}{unregisterGLBufferObject}\hyperlink{particle_system_8cuh_a9afef8c00ca779aae2d7484b45bce34c}{(}
      \hyperlink{class_particle_system_a9c5de70c1705672e5722ad30dee1b14b}{m\_cuda\_posvbo\_resource}\hyperlink{particle_system_8cuh_a9afef8c00ca779aae2d7484b45bce34c}{)};
00386                     glBindBuffer(GL\_ARRAY\_BUFFER, m\_posVbo);
00387                     glBufferSubData(GL\_ARRAY\_BUFFER, start*4*\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{float}), count*4*\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{float}), 
      data);
00388                     glBindBuffer(GL\_ARRAY\_BUFFER, 0);
00389                     \hyperlink{particle_system_8cuh_a4386a84282ceeaba09939817aa2a9c24}{registerGLBufferObject}\hyperlink{particle_system_8cuh_a4386a84282ceeaba09939817aa2a9c24}{(}\hyperlink{class_particle_system_a31f9cccdf5dbae6f72867665bd8761e3}{m\_posVbo}
      \hyperlink{particle_system_8cuh_a4386a84282ceeaba09939817aa2a9c24}{,} &\hyperlink{class_particle_system_a9c5de70c1705672e5722ad30dee1b14b}{m\_cuda\_posvbo\_resource}\hyperlink{particle_system_8cuh_a4386a84282ceeaba09939817aa2a9c24}{)};
00390                 \}
00391             \}
00392             \textcolor{keywordflow}{break};
00393 
00394         \textcolor{keywordflow}{case} \hyperlink{class_particle_system_a332fbe57a36aaea5c18b4ea4fba6bbb3a3702de73065f01b4f6ffa604b799e53d}{VELOCITY}:
00395             \hyperlink{particle_system_8cuh_ac4d4ecd921dbed6c2deef639ca295374}{copyArrayToDevice}\hyperlink{particle_system_8cuh_ac4d4ecd921dbed6c2deef639ca295374}{(}\hyperlink{class_particle_system_a5efd31a2fdba8d98b105f4e546964cb5}{m\_dVel}\hyperlink{particle_system_8cuh_ac4d4ecd921dbed6c2deef639ca295374}{,} data\hyperlink{particle_system_8cuh_ac4d4ecd921dbed6c2deef639ca295374}{,} start*4*\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{float})
      \hyperlink{particle_system_8cuh_ac4d4ecd921dbed6c2deef639ca295374}{,} count*4*\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{float})\hyperlink{particle_system_8cuh_ac4d4ecd921dbed6c2deef639ca295374}{)};
00396             \textcolor{keywordflow}{break};
00397     \}
00398 \}
00399 
\hypertarget{particle_system_8cpp_source_l00400}{}\hyperlink{particle_system_8cpp_a5459f6b6b39f9a6b80de7f17c3777ee2}{00400} \textcolor{keyword}{inline} \textcolor{keywordtype}{float} \hyperlink{particle_system_8cpp_a5459f6b6b39f9a6b80de7f17c3777ee2}{frand}()
00401 \{
00402     \textcolor{keywordflow}{return} rand() / (\textcolor{keywordtype}{float}) RAND\_MAX;
00403 \}
00404 
00405 \textcolor{keywordtype}{void}
\hypertarget{particle_system_8cpp_source_l00406}{}\hyperlink{class_particle_system_a2e08c4e354b0de5e2dc468a0fb457dfe}{00406} \hyperlink{class_particle_system}{ParticleSystem}::\hyperlink{class_particle_system_a2e08c4e354b0de5e2dc468a0fb457dfe}{initGrid}(\hyperlink{particles__kernel_8cuh_a91ad9478d81a7aaf2593e8d9c3d06a14}{uint} *size, \textcolor{keywordtype}{float} spacing, \textcolor{keywordtype}{float} jitter, 
      \hyperlink{particles__kernel_8cuh_a91ad9478d81a7aaf2593e8d9c3d06a14}{uint} numParticles)
00407 \{
00408     srand(1973);
00409 
00410     \textcolor{keywordflow}{for} (\hyperlink{particles__kernel_8cuh_a91ad9478d81a7aaf2593e8d9c3d06a14}{uint} z=0; z<size[2]; z++)
00411     \{
00412         \textcolor{keywordflow}{for} (\hyperlink{particles__kernel_8cuh_a91ad9478d81a7aaf2593e8d9c3d06a14}{uint} y=0; y<size[1]; y++)
00413         \{
00414             \textcolor{keywordflow}{for} (\hyperlink{particles__kernel_8cuh_a91ad9478d81a7aaf2593e8d9c3d06a14}{uint} x=0; x<size[0]; x++)
00415             \{
00416                 \hyperlink{particles__kernel_8cuh_a91ad9478d81a7aaf2593e8d9c3d06a14}{uint} i = (z*size[1]*size[0]) + (y*size[0]) + x;
00417 
00418                 \textcolor{keywordflow}{if} (i < numParticles)
00419                 \{
00420                     m\_hPos[i*4] = (spacing * x) + m\_params.particleRadius - 1.0f + (frand()*2.0f-1.0f)
      *jitter;
00421                     m\_hPos[i*4+1] = (spacing * y) + m\_params.particleRadius - 1.0f + (frand()*2.0f-
      1.0f)*jitter;
00422                     m\_hPos[i*4+2] = (spacing * z) + m\_params.particleRadius - 1.0f + (frand()*2.0f-
      1.0f)*jitter;
00423                     \hyperlink{class_particle_system_ab9d75471d2eaaeb8fa98d2f3f47d9c25}{m\_hPos}[i*4+3] = 1.0f;
00424 
00425                     \hyperlink{class_particle_system_a20560c896ee8a8bbc827a8e5902da7e2}{m\_hVel}[i*4] = 0.0f;
00426                     \hyperlink{class_particle_system_a20560c896ee8a8bbc827a8e5902da7e2}{m\_hVel}[i*4+1] = 0.0f;
00427                     \hyperlink{class_particle_system_a20560c896ee8a8bbc827a8e5902da7e2}{m\_hVel}[i*4+2] = 0.0f;
00428                     \hyperlink{class_particle_system_a20560c896ee8a8bbc827a8e5902da7e2}{m\_hVel}[i*4+3] = 0.0f;
00429                 \}
00430             \}
00431         \}
00432     \}
00433 \}
00434 
00435 \textcolor{keywordtype}{void}
\hypertarget{particle_system_8cpp_source_l00436}{}\hyperlink{class_particle_system_a519070812dd9eb349f270c793c5f64b6}{00436} \hyperlink{class_particle_system}{ParticleSystem}::\hyperlink{class_particle_system_a519070812dd9eb349f270c793c5f64b6}{reset}(\hyperlink{class_particle_system_a1dca3996c8068602412ef9f7826605d1}{ParticleConfig} config)
00437 \{
00438     \textcolor{keywordflow}{switch} (config)
00439     \{
00440         \textcolor{keywordflow}{default}:
00441         \textcolor{keywordflow}{case} \hyperlink{class_particle_system_a1dca3996c8068602412ef9f7826605d1a053c69e4e6b094605ea152a644e7c9ee}{CONFIG\_RANDOM}:
00442             \{
00443                 \textcolor{keywordtype}{int} p = 0, v = 0;
00444 
00445                 \textcolor{keywordflow}{for} (\hyperlink{particles__kernel_8cuh_a91ad9478d81a7aaf2593e8d9c3d06a14}{uint} i=0; i < \hyperlink{class_particle_system_a23d238efa80a647d4b6cde034f486a91}{m\_numParticles}; i++)
00446                 \{
00447                     \textcolor{keywordtype}{float} point[3];
00448                     \textcolor{comment}{//point[0] = frand();}
00449                     \textcolor{comment}{//point[1] = frand();}
00450                     \textcolor{comment}{//point[2] = frand();}
00451                                         point[0]=2.0f*\hyperlink{particle_system_8cpp_a5459f6b6b39f9a6b80de7f17c3777ee2}{frand}\hyperlink{particle_system_8cpp_a5459f6b6b39f9a6b80de7f17c3777ee2}{(}\hyperlink{particle_system_8cpp_a5459f6b6b39f9a6b80de7f17c3777ee2}{)}-1.0f;\textcolor{comment}{//frand -> (0.0f,1.0f) 1.0f
       - promien kuli}
00452                                         \textcolor{keywordtype}{float} my=sqrt(1-point[0]*point[0]);
00453                                         point[1]=rand() /( \textcolor{keywordtype}{float} ) RAND\_MAX *( 2*my ) - my;
00454                                         \textcolor{keywordtype}{float} mz=sqrt(1-point[0]*point[0]-point[1]*point[1]);
00455                                         point[2]=rand() /( \textcolor{keywordtype}{float} ) RAND\_MAX *( 2*mz ) - mz;
00456 
00457                     \hyperlink{class_particle_system_ab9d75471d2eaaeb8fa98d2f3f47d9c25}{m\_hPos}[p++] = 2 * (point[0] - 0.0f);
00458                     \hyperlink{class_particle_system_ab9d75471d2eaaeb8fa98d2f3f47d9c25}{m\_hPos}[p++] = 2 * (point[1] - 0.0f);
00459                     \hyperlink{class_particle_system_ab9d75471d2eaaeb8fa98d2f3f47d9c25}{m\_hPos}[p++] = 2 * (point[2] - 0.0f);
00460                     \hyperlink{class_particle_system_ab9d75471d2eaaeb8fa98d2f3f47d9c25}{m\_hPos}[p++] = 1.0f; \textcolor{comment}{// radius}
00461                     \hyperlink{class_particle_system_a20560c896ee8a8bbc827a8e5902da7e2}{m\_hVel}[v++] = 0.0f;
00462                     \hyperlink{class_particle_system_a20560c896ee8a8bbc827a8e5902da7e2}{m\_hVel}[v++] = 0.0f;
00463                     \hyperlink{class_particle_system_a20560c896ee8a8bbc827a8e5902da7e2}{m\_hVel}[v++] = 0.0f;
00464                     \hyperlink{class_particle_system_a20560c896ee8a8bbc827a8e5902da7e2}{m\_hVel}[v++] = 0.0f;
00465                 \}
00466             \}
00467             \textcolor{keywordflow}{break};
00468 
00469         \textcolor{keywordflow}{case} \hyperlink{class_particle_system_a1dca3996c8068602412ef9f7826605d1aa6bd9e92edfc102877bf103547397b47}{CONFIG\_GRID}:
00470             \{
00471                 \textcolor{keywordtype}{float} jitter = m\_params.particleRadius*0.01f;
00472                 \hyperlink{particles__kernel_8cuh_a91ad9478d81a7aaf2593e8d9c3d06a14}{uint} s = (\textcolor{keywordtype}{int}) ceilf(powf((\textcolor{keywordtype}{float}) \hyperlink{class_particle_system_a23d238efa80a647d4b6cde034f486a91}{m\_numParticles}, 1.0f / 3.0f));
00473                 \hyperlink{particles__kernel_8cuh_a91ad9478d81a7aaf2593e8d9c3d06a14}{uint} gridSize[3];
00474                 gridSize[0] = gridSize[1] = gridSize[2] = s;
00475                 initGrid(gridSize, m\_params.particleRadius*2.0f, jitter, m\_numParticles);
00476             \}
00477             \textcolor{keywordflow}{break};
00478     \}
00479 
00480     \hyperlink{class_particle_system_aa792a66680e800832059854aab0d594d}{setArray}\hyperlink{class_particle_system_aa792a66680e800832059854aab0d594d}{(}\hyperlink{class_particle_system_a332fbe57a36aaea5c18b4ea4fba6bbb3a9e9a2992d230a2674debf26e0e8e0299}{POSITION}\hyperlink{class_particle_system_aa792a66680e800832059854aab0d594d}{,} \hyperlink{class_particle_system_ab9d75471d2eaaeb8fa98d2f3f47d9c25}{m\_hPos}\hyperlink{class_particle_system_aa792a66680e800832059854aab0d594d}{,} 0\hyperlink{class_particle_system_aa792a66680e800832059854aab0d594d}{,} \hyperlink{class_particle_system_a23d238efa80a647d4b6cde034f486a91}{m\_numParticles}
      \hyperlink{class_particle_system_aa792a66680e800832059854aab0d594d}{)};
00481     \hyperlink{class_particle_system_aa792a66680e800832059854aab0d594d}{setArray}\hyperlink{class_particle_system_aa792a66680e800832059854aab0d594d}{(}\hyperlink{class_particle_system_a332fbe57a36aaea5c18b4ea4fba6bbb3a3702de73065f01b4f6ffa604b799e53d}{VELOCITY}\hyperlink{class_particle_system_aa792a66680e800832059854aab0d594d}{,} \hyperlink{class_particle_system_a20560c896ee8a8bbc827a8e5902da7e2}{m\_hVel}\hyperlink{class_particle_system_aa792a66680e800832059854aab0d594d}{,} 0\hyperlink{class_particle_system_aa792a66680e800832059854aab0d594d}{,} \hyperlink{class_particle_system_a23d238efa80a647d4b6cde034f486a91}{m\_numParticles}
      \hyperlink{class_particle_system_aa792a66680e800832059854aab0d594d}{)};
00482 \}
00483 
00484 \textcolor{keywordtype}{void}
\hypertarget{particle_system_8cpp_source_l00485}{}\hyperlink{class_particle_system_af2f16676fe8a0523cfb867a9a856970c}{00485} \hyperlink{class_particle_system}{ParticleSystem}::\hyperlink{class_particle_system_af2f16676fe8a0523cfb867a9a856970c}{addSphere}(\textcolor{keywordtype}{int} start, \textcolor{keywordtype}{float} *pos, \textcolor{keywordtype}{float} *vel, \textcolor{keywordtype}{int} r, \textcolor{keywordtype}{float} 
      spacing)
00486 \{
00487     \hyperlink{particles__kernel_8cuh_a91ad9478d81a7aaf2593e8d9c3d06a14}{uint} index = start;
00488 
00489     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} z=-r; z<=r; z++)
00490     \{
00491         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} y=-r; y<=r; y++)
00492         \{
00493             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} x=-r; x<=r; x++)
00494             \{
00495                 \textcolor{keywordtype}{float} dx = x*spacing;
00496                 \textcolor{keywordtype}{float} dy = y*spacing;
00497                 \textcolor{keywordtype}{float} dz = z*spacing;
00498                 \textcolor{keywordtype}{float} l = sqrtf(dx*dx + dy*dy + dz*dz);
00499                 \textcolor{keywordtype}{float} jitter = m\_params.particleRadius*0.01f;
00500 
00501                 \textcolor{keywordflow}{if} ((l <= m\_params.particleRadius*2.0f*r) && (index < m\_numParticles))
00502                 \{
00503                     m\_hPos[index*4]   = pos[0] + dx + (frand()*2.0f-1.0f)*jitter;
00504                     m\_hPos[index*4+1] = pos[1] + dy + (frand()*2.0f-1.0f)*jitter;
00505                     m\_hPos[index*4+2] = pos[2] + dz + (frand()*2.0f-1.0f)*jitter;
00506                     m\_hPos[index*4+3] = pos[3];
00507 
00508                     m\_hVel[index*4]   = vel[0];
00509                     m\_hVel[index*4+1] = vel[1];
00510                     m\_hVel[index*4+2] = vel[2];
00511                     m\_hVel[index*4+3] = vel[3];
00512                     index++;
00513                 \}
00514             \}
00515         \}
00516     \}
00517 
00518     \hyperlink{class_particle_system_aa792a66680e800832059854aab0d594d}{setArray}\hyperlink{class_particle_system_aa792a66680e800832059854aab0d594d}{(}\hyperlink{class_particle_system_a332fbe57a36aaea5c18b4ea4fba6bbb3a9e9a2992d230a2674debf26e0e8e0299}{POSITION}\hyperlink{class_particle_system_aa792a66680e800832059854aab0d594d}{,} \hyperlink{class_particle_system_ab9d75471d2eaaeb8fa98d2f3f47d9c25}{m\_hPos}\hyperlink{class_particle_system_aa792a66680e800832059854aab0d594d}{,} start\hyperlink{class_particle_system_aa792a66680e800832059854aab0d594d}{,} index\hyperlink{class_particle_system_aa792a66680e800832059854aab0d594d}{)};
00519     \hyperlink{class_particle_system_aa792a66680e800832059854aab0d594d}{setArray}\hyperlink{class_particle_system_aa792a66680e800832059854aab0d594d}{(}\hyperlink{class_particle_system_a332fbe57a36aaea5c18b4ea4fba6bbb3a3702de73065f01b4f6ffa604b799e53d}{VELOCITY}\hyperlink{class_particle_system_aa792a66680e800832059854aab0d594d}{,} \hyperlink{class_particle_system_a20560c896ee8a8bbc827a8e5902da7e2}{m\_hVel}\hyperlink{class_particle_system_aa792a66680e800832059854aab0d594d}{,} start\hyperlink{class_particle_system_aa792a66680e800832059854aab0d594d}{,} index\hyperlink{class_particle_system_aa792a66680e800832059854aab0d594d}{)};
00520 \}
\end{DoxyCode}
